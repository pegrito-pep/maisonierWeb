(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-42c0aafb"],{"074f":function(e,t,a){"use strict";a("d257")},ad35:function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"container-fluid"},[a("page-description",{attrs:{title:"Loyers",description:"Fiche de loyers",icon:"list",path:["Finances","Loyers"]}}),a("div",{staticClass:"row"},[a("div",{staticClass:"col-md-12"},[a("div",{staticClass:"mb-2 clearfix"},[a("div",{staticClass:"collapse d-md-block display-options",attrs:{id:"displayOptions"}},[a("div",{staticClass:"d-block d-md-inline-block"},[a("div",{staticClass:"search-sm d-inline-block float-md-left mr-1 mb-1 align-top"},[a("form",{attrs:{action:"",onSubmit:"return false"}},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.search,expression:"search"}],staticClass:"form-control",attrs:{type:"text",placeholder:"Recherche..."},domProps:{value:e.search},on:{input:function(t){t.target.composing||(e.search=t.target.value)}}}),e._m(0)])])]),a("div",{staticClass:"float-md-right"},[a("div",{staticClass:"d-flex "},[a("b-form-select",{staticClass:"form-control",attrs:{size:"sm",options:e.mois},on:{input:function(t){return e.setIndexesMois(t,e.periode.annee)}},model:{value:e.periode.mois,callback:function(t){e.$set(e.periode,"mois",t)},expression:"periode.mois"}}),a("b-form-select",{staticClass:"form-control",attrs:{size:"sm",options:e.annees},on:{input:function(t){return e.setIndexesMois(e.periode.mois,t)}},model:{value:e.periode.annee,callback:function(t){e.$set(e.periode,"annee",t)},expression:"periode.annee"}})],1)])])]),a("div",{staticClass:"separator mb-20"}),a("b-overlay",{attrs:{show:e.showOverlay,rounded:"sm"}},[e.occupations.length?a("b-row",[a("div",{staticClass:"card-body"},[a("b-table-simple",{attrs:{hover:"",small:"",responsive:""}},[a("b-thead",{attrs:{"head-variant":"light"}},[a("b-tr",{staticClass:"text-center"},[a("b-th",[e._v("Logement")]),a("b-th",[e._v("Locataire")]),a("b-th",[e._v("Loyer de base")]),a("b-th",[e._v("Consommation en eau")]),a("b-th",[e._v("Consommation en lumière")]),a("b-th",[e._v("Action")])],1)],1),a("b-tbody",e._l(e.items,(function(t){return a("b-tr",{key:t.idOccupation},[a("b-td",{staticClass:"px-2 py-1"},[a("span",{staticClass:"d-inline-block w-100 mb-1 font-weight-bold"},[e._v(e._s(t.logement.refLogement))]),a("span",{staticClass:"d-inline-block w-100 mt-1 text-muted"},[e._v(" "+e._s(t.logement.sousTypeLogement.libelleSousType)+" "),t.logement.batiment?a("span",[e._v(" / Batiment : "+e._s(t.logement.batiment.nomBatiment))]):e._e()])]),a("b-td",{staticClass:"p-1"},[a("span",{staticClass:"d-inline-block w-100 mb-1 font-weight-bold"},[e._v(e._s(t.locataire.titre+" "+t.locataire.nomLocataire+" "+t.locataire.prenomLocataire))]),a("span",{staticClass:"d-inline-block w-100 mt-1 text-muted"},[e._v(e._s(t.locataire.tel+" / "+t.locataire.email))])]),a("b-td",{staticClass:"p-1",domProps:{innerHTML:e._s(e._display_loyer(t))}}),a("b-td",{staticClass:"p-1",domProps:{innerHTML:e._s(e._display_consommation(t,"eau"))}}),a("b-td",{staticClass:"p-1",domProps:{innerHTML:e._s(e._display_consommation(t,"energie"))}}),a("b-td",[a("b-dropdown",{attrs:{right:""},scopedSlots:e._u([{key:"button-content",fn:function(){return[a("i",{staticClass:"fa fa-ellipsis-h"})]},proxy:!0}],null,!0)},[a("b-dropdown-item",{attrs:{to:{name:"details-occupation",params:{id:t.idOccupation}}}},[e._v("Détails de l'occupation")]),a("b-dropdown-item",{attrs:{href:"#"},on:{click:function(a){return a.preventDefault(),e.doPayment(t)}}},[e._v("Effectuer un paiement")]),a("b-dropdown-item",{attrs:{href:"#"},on:{click:function(a){return a.preventDefault(),e.correspondance(t)}}},[e._v("Correspondance")])],1)],1)],1)})),1)],1)],1)]):a("b-alert",{staticClass:"text-center",attrs:{variant:"info",show:""}},[a("i",{staticClass:"fa fa-exclamation-triangle fa-3x"}),e._v(" "),a("br"),a("span",{staticClass:"h4 d-inline-flex ml-2"},[e._v("Vous n'avez défini aucune occupation pour le moment")])]),a("paginator",{attrs:{hr:"top",offset:e.offset,total:e.occupations.length,limit:e.perPage,page:e.currentPage},on:{pageChanged:function(t){e.currentPage=t},limitChanged:function(t){e.perPage=t}}})],1)],1)]),e.occupation?a("div",[a("b-modal",{attrs:{id:"paiement",title:"Ajout de paiement",size:"lg","no-close-on-backdrop":"","ok-only":"","ok-title":"Valider","ok-variant":"danger"}},[a("div",{staticClass:"jumbotron pt-10 pb-10 px-2"},[a("h4",{staticClass:"text-center"},[e._v("Effectuer un versement pour:")]),a("b-row",[a("b-col",[a("dl",[a("dt",[e._v("Logement")]),a("dd",[e._v(e._s(e.occupation.logement.refLogement)+" / "+e._s(e.occupation.logement.sousTypeLogement.libelleSousType)+" "),a("br"),e._v(" "),e.occupation.logement.batiment?a("span",[e._v("Batiment : "+e._s(e.occupation.logement.batiment.nomBatiment))]):e._e()])])]),a("b-col",[a("dl",[a("dt",[e._v("Locataire")]),a("dd",[e._v(e._s(e.occupation.locataire.titre+" "+e.occupation.locataire.nomLocataire+" "+e.occupation.locataire.prenomLocataire)+" "),a("br"),e._v(" "+e._s(e.occupation.locataire.tel+" / "+e.occupation.locataire.email))])])])],1)],1),a("b-row",[a("b-col",[a("h5",{staticClass:"border-bottom mb-3"},[e._v("Paiement du loyer")]),a("b-form-group",{attrs:{label:"Type de paiement",description:"Par quel canal doit-on effectuer le paiement"}},[a("b-form-select",{attrs:{options:[{text:"Selectionnez une méthode",value:null,disabled:!0},{text:"Payer en espèce",value:"espece"},{text:"Payer à partir du compte loyer",value:"loyer"}]},model:{value:e.paiement.type,callback:function(t){e.$set(e.paiement,"type",t)},expression:"paiement.type"}})],1),a("b-form-group",{attrs:{label:"Montant",description:"Combien doit-on verser"}},[a("b-form-input",{attrs:{type:"number",disabled:""},model:{value:e.paiement.loyer,callback:function(t){e.$set(e.paiement,"loyer",t)},expression:"paiement.loyer"}})],1)],1),a("b-col",[a("h5",{staticClass:"border-bottom mb-3"},[e._v("Paiement de l'eau")]),a("b-form-group",{attrs:{label:"Type de paiement",description:"Par quel canal doit-on effectuer le paiement"}},[a("b-form-select",{attrs:{options:[{text:"Selectionnez une méthode",value:null,disabled:!0},{text:"Payer en espèce",value:"espece"},{text:"Payer à partir de compte eau",value:"eau"}]},model:{value:e.paiement.type,callback:function(t){e.$set(e.paiement,"type",t)},expression:"paiement.type"}})],1),a("b-form-group",{attrs:{label:"Montant",description:"Combien doit-on verser"}},[a("b-form-input",{attrs:{type:"number",disabled:""},model:{value:e.paiement.eau,callback:function(t){e.$set(e.paiement,"eau",t)},expression:"paiement.eau"}})],1)],1),a("b-col",[a("h5",{staticClass:"border-bottom mb-3"},[e._v("Paiement de la lumière")]),a("b-form-group",{attrs:{label:"Type de paiement",description:"Par quel canal doit-on effectuer le paiement"}},[a("b-form-select",{attrs:{options:[{text:"Selectionnez une méthode",value:null,disabled:!0},{text:"Payer en espèce",value:"espece"},{text:"Payer à partir de compte lumière",value:"energie"}]},model:{value:e.paiement.type,callback:function(t){e.$set(e.paiement,"type",t)},expression:"paiement.type"}})],1),a("b-form-group",{attrs:{label:"Montant",description:"Combien doit-on verser"}},[a("b-form-input",{attrs:{type:"number",disabled:""},model:{value:e.paiement.energie,callback:function(t){e.$set(e.paiement,"energie",t)},expression:"paiement.energie"}})],1)],1)],1)],1)],1):e._e(),e.occupation?a("div",[a("b-modal",{attrs:{id:"correspondance",title:"Correspondance","no-close-on-backdrop":"","ok-only":"","ok-title":"Fermer","ok-variant":"secondary"}},[e.occupation.dateFin?a("b-alert",{staticClass:"text-center",attrs:{show:"",variant:"info"}},[a("i",{staticClass:"fa fa-exclamation-triangle fa-5x"}),e._v(" "),a("br"),a("p",{staticClass:"fa-2x mt-5 pt-2"},[e._v("Bail terminé le "+e._s(e.$dayjs(e.occupation.dateFin).format("dddd, DD MMMM YYYY")))])]):a("div",[a("b-card",{staticClass:"border"},[a("span",{staticClass:"float-right d-inline-block mb-5"},[e._v("Yaoundé le "+e._s(e.$dayjs().format("DD MMMM YYYY"))+" ")]),a("br"),a("div",{staticClass:"clearfix my-3"},[a("span",{staticClass:"text-underline"},[e._v("Object: ")]),a("b",{staticClass:"fa-lg"},[e._v("Loyer du mois de : "+e._s(e._find_periode_loyer(e.occupation)))])]),a("p",[a("b",[e._v(e._s(e.occupation.locataire.titre+" "+e.occupation.locataire.nomLocataire+" "+e.occupation.locataire.prenomLocataire)+" ("+e._s(e.occupation.locataire.tel)+")")]),e._v(", vous occupez le logement "),a("b",[e._v(e._s(e.occupation.logement.refLogement)+" / "+e._s(e.occupation.logement.sousTypeLogement.libelleSousType))]),e._v(" situé à "),a("b",[e._v(e._s(e.occupation.logement.adresse.ville+" "+e.occupation.logement.adresse.pays+", "+e.occupation.logement.adresse.quartier))]),e._v(". "),a("br"),e._v(" Ci-dessous, votre loyer du mois de "+e._s(e._find_periode_loyer(e.occupation))+" ")]),a("b-table-simple",[a("b-tbody",[a("b-tr",[a("b-th",[e._v("Loyer de base")]),a("b-td",[e._v(e._s(e.occupation.loyerBase)+" F")])],1),a("b-tr",[a("b-th",[e._v("Consommation en eau")]),a("b-td",[e._v(e._s(e._calcul_consommation(e.occupation,"eau"))+" F")])],1),a("b-tr",[a("b-th",[e._v("Consommation en lumière")]),a("b-td",[e._v(e._s(e._calcul_consommation(e.occupation,"energie"))+" F")])],1),a("b-tr",[a("b-th",[e._v("Total")]),a("b-td",[a("b",{staticClass:"fa-2x text-primary"},[e._v(" "+e._s(parseInt(e.occupation.loyerBase)+e._calcul_consommation(e.occupation,"energie")+e._calcul_consommation(e.occupation,"eau"))+" F ")])])],1)],1)],1)],1)],1)],1)],1):e._e()],1)},n=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("button",{staticClass:"btn btn-icon",attrs:{type:"submit"}},[a("i",{staticClass:"ik ik-search"})])}];const s=a("5a6f");var i={name:"list-occupations",data:()=>({search:null,showOverlay:!0,currentPage:1,perPage:10,occupations:[],trueOccupations:[],periode:{annee:null,mois:null},paiement:{type:null,loyer:0,eau:0},occupation:null}),computed:{items(){return s.array_slice(this.occupations.filter(e=>this.$dayjs(e.dateDeb).diff(this.periodeCourante,"month")>=0&&(s.empty(e.dateFin)||this.$dayjs(e.dateFin).diff(this.periodeCourante,"month")<=0)),this.offset,this.perPage)},offset(){return this.currentPage*this.perPage-this.perPage},annees(){const e=this.$dayjs().format("YYYY");let t=[e];for(let a=e;a>e-5;a--)a!=e&&t.push(a);return t.sort((e,t)=>e-t)},mois(){const e=new Date,t=[],a=this.$dayjs().format("YYYY"),o=a==this.periode.annee?e.getMonth():11;for(let n=0;n<=o;n++)e.setMonth(n),t.push({value:n,text:s.ucfirst(this.$dayjs(e).format("MMMM"))});return t},periodeCourante(){let e=this.periode.mois+1;return e<10&&(e="0"+e),this.periode.annee+"-"+e+"-01"}},beforeMount(){this.periode={mois:parseInt(this.$dayjs().format("M"))-1,annee:parseInt(this.$dayjs().format("YYYY"))},this.getOccupations()},methods:{sendData(){},getOccupations(){axios.get("occupations").then(e=>e.result||[]).then(e=>{this.occupations=this.trueOccupations=e,this.showOverlay=!1})},doPayment(e){this.occupation=e,this.paiement.loyer=e.loyerBase,this.paiement.eau=this._calcul_consommation(e,"eau"),this.paiement.energie=this._calcul_consommation(e,"energie"),setTimeout(()=>{this.$bvModal.show("paiement")},50)},correspondance(e){this.occupation=e,setTimeout(()=>{this.$bvModal.show("correspondance")},50)},_calcul_consommation(e,t){const a=e.indexes.filter(e=>e.typeIndexe==t),o={eau:e.modeEau,energie:e.modeEnergie},n={eau:e.puEau,energie:e.puEnergie};let s=this.getIndexesPeriode(this.periodeCourante,a)[0],i=1;return s?"index"==o[t]&&(i=s.nouveau-s.ancien):i=0,i*n[t]},_display_consommation(e,t){const a=this._calcul_consommation(e,t);let o="danger",n="Impayé";return 0==a&&(o="secondary",n="Non consommé"),`<span class="badge w-100 badge-${o}">\n                <b>${a}</b> F <br>\n                <span class="small">${n}</span>\n            </span>`},_display_loyer(e){const t=e.loyers.filter(e=>0==this.$dayjs(this.periodeCourante).diff(e.periode,"month"));let a="danger",o="Impayé";if(t.length){const n=t.reduce((e,t)=>e+t.montantPayer);0!=n&&(n<e.loyerBase?(a="warning",o="Avancé : "+n+" F"):(a="success",o="Payé"))}return`<span class="badge w-100 badge-${a}">\n                <b>${e.loyerBase}</b> F <br>\n                <span class="small">${o}</span>\n            </span>`},_find_periode_loyer(e){return"prepayer"==e.modePaiement?this.$dayjs(this.periodeCourante).add(1,"month").format("MMMM YYYY"):this.$dayjs(this.periodeCourante).format("MMMM YYYY")},getIndexesPeriode(e,t){return t.filter(t=>0==this.$dayjs(e).diff(t.periode,"month"))}}},r=i,l=(a("074f"),a("2877")),c=Object(l["a"])(r,o,n,!1,null,"a2d975c8",null);t["default"]=c.exports},d257:function(e,t,a){}}]);
//# sourceMappingURL=chunk-42c0aafb.2a05df89.js.map