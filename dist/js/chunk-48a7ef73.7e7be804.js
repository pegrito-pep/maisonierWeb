(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-48a7ef73"],{"0e80":function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container-fluid position-relative"},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-md-12"},[a("div",{staticClass:"mb-2 clearfix"},[a("div",{staticClass:"collapse d-md-block display-options",attrs:{id:"displayOptions"}},[a("div",{staticClass:"d-block d-md-inline-block"},[a("SearchForm",{model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})],1),a("div",{staticClass:"d-flex align-items-center justify-content-end"},[a("btnAdd",{directives:[{name:"b-modal",rawName:"v-b-modal.occupationForm",modifiers:{occupationForm:!0}}],attrs:{message:"Créer un bail"}}),a("b-button-group",{staticClass:"mt-n1"},[a("b-button",{staticClass:"text-danger",attrs:{variant:"outline-light"},on:{click:function(e){return e.preventDefault(),t.goTo("prev")}}},[a("i",{staticClass:"fa fa-2x fa-chevron-left"})]),a("b-button",{staticClass:"text-danger",attrs:{variant:"outline-light"},on:{click:function(e){return e.preventDefault(),t.goTo("next")}}},[a("i",{staticClass:"fa fa-2x fa-chevron-right"})]),a("b-button",{staticClass:"text-danger",attrs:{variant:"outline-light"},on:{click:function(e){return e.preventDefault(),t.toogleList.apply(null,arguments)}}},[a("i",{staticClass:"fa fa-2x fa-list-alt",attrs:{id:"toogleList"}})])],1)],1)])]),a("div",{staticClass:"separator mb-20"}),a("b-overlay",{attrs:{show:t.showOverlay,rounded:"sm"}},[t.occupations.length?a("div",[a("occupation",{attrs:{occupation:t.occupation},on:{change:t.getOccupations,makeUpdate:t.setUpdateOccupation,showDetails:t.showDetails}})],1):a("b-alert",{staticClass:"text-center",attrs:{variant:"info",show:""}},[a("i",{staticClass:"fa fa-exclamation-triangle fa-3x"}),t._v(" "),a("br"),a("span",{staticClass:"h4 d-inline-flex ml-2"},[t._v("Vous n'avez défini aucune occupation pour le moment")])])],1)],1),a("div",{staticClass:"occupations-sidenav py-2",attrs:{id:"mySidenav"}},[a("h5",{staticClass:"text-center text-white border-bottom py-1"},[t._v("Occupations disponibles")]),a("form",{staticClass:"container",attrs:{action:"",onSubmit:"return false"}},[a("b-form-input",{attrs:{placeholder:"Recherche..."},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})],1),a("b-container",{staticClass:"my-2",staticStyle:{height:"76%","overflow-y":"auto"}},[a("b-list-group",t._l(t.items,(function(e,o){return a("b-list-group-item",{key:e.idOccupation||o,staticClass:"mb-1 p-1",class:{active:e.idOccupation==t.occupation.idOccupation},on:{click:function(a){return a.preventDefault(),t.selectLogement(e)}}},[a("dl",{staticClass:"d-flex m-0"},[a("dt",{staticClass:"pl-1 col-1"},[a("i",{staticClass:"fa fa-home"})]),a("dd",{staticClass:"col-11 pl-1 truncate"},[t._v(t._s(e.logement.refLogement)+" / "),a("span",{staticClass:"text-muted small"},[t._v(t._s(e.logement.sousTypeLogement.libelleSousType))])])]),a("dl",{staticClass:"d-flex m-0"},[a("dt",{staticClass:"pl-1 col-1"},[a("i",{staticClass:"fa fa-user"})]),a("dd",{staticClass:"col-11 pl-1 truncate"},[t._v(t._s(e.locataire.titre+" "+e.locataire.nomLocataire+" "+e.locataire.prenomLocataire))])]),a("div",{staticClass:"text-center"},[null==e.dateFin?a("b-badge",{attrs:{variant:"success"}},[t._v("Bail en cours")]):a("b-badge",{attrs:{variant:"danger"}},[t._v("Bail terminé le "+t._s(t.$date(t.occupation.dateFin).format("DD MMMM YYYY")))])],1)])})),1)],1),a("div",{staticClass:"d-flex justify-content-center w-100"},[a("paginator",{attrs:{"no-control":"",offset:t.offset,total:t.occupations.length,limit:t.perPage,page:t.currentPage},on:{pageChanged:function(e){t.currentPage=e},limitChanged:function(e){t.perPage=e}}})],1)],1)]),a("b-modal",{ref:"occupation-form",attrs:{id:"occupationForm",size:"xl",title:t.title,"hide-footer":"","no-close-on-backdrop":"","hide-header-close":""},scopedSlots:t._u([{key:"modal-title",fn:function(){return[a("span",{staticClass:"ml-4 text-form-occupation"},[t._v(t._s(t.title))])]},proxy:!0}])},[a("div",[a("occupation-form",{attrs:{action:t.action,provenance:t.provenance},on:{occupationAdded:t.addedOccupation,createLogementSecond:t.goToLogement,createLocataire:t.gotToLocataire,closeOccupationModal:t.resetOccupationFormProps}})],1)]),t.occupation?a("div",{staticClass:"modal fade edit-layout-modal",attrs:{id:"editLayoutItem",tabindex:"-1",role:"dialog","aria-labelledby":"editLayoutItemLabel","aria-hidden":"true"}},[a("div",{staticClass:"modal-dialog",attrs:{role:"document"}},[a("div",{staticClass:"modal-content"},[a("div",{staticClass:"modal-header"},[a("h5",{staticClass:"modal-title",attrs:{id:"editLayoutItemLabel"}},[t._v(" Contrat de l'occupation : "),a("b",[t._v(t._s(t.occupation.idOccupation))]),t._v(". ")]),t._m(0)]),a("div",{staticClass:"modal-body pt-2"},[a("contrat-occupation",{attrs:{occupation:t.occupation}})],1)])])]):t._e()],1)},i=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal","aria-label":"Close"}},[a("span",{attrs:{"aria-hidden":"true"}},[t._v("×")])])}],s=a("278e"),n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"well-display",staticStyle:{height:"130em"}},[a("printer",{attrs:{display:!0,id:"printer-contrat"},on:{input:function(e){t.print=!1}},model:{value:t.print,callback:function(e){t.print=e},expression:"print"}},[a("vue-editor",{staticStyle:{height:"120em"},attrs:{disabled:!0,editorToolbar:t.customToolbar},model:{value:t.occupation.contrat.contenu,callback:function(e){t.$set(t.occupation.contrat,"contenu",e)},expression:"occupation.contrat.contenu"}})],1),a("div",{staticClass:"float-right"},[a("b-button",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.top",value:"Imprimer",expression:"'Imprimer'",modifiers:{top:!0}}],staticClass:"mt-4",attrs:{variant:"outline-primary"},on:{click:function(e){return e.preventDefault(),t.setPrint.apply(null,arguments)}}},[a("i",{staticClass:"fas fa-print"}),t._v("Imprimer")])],1)],1)])},c=[],l=a("5873"),r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{class:{displayed:1==t.display},attrs:{id:"print-area"}},[a("div",{attrs:{id:t.id}},[t._m(0),a("div",{staticClass:"my-3"},[t._t("default")],2),a("footer")])])},u=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("header",{staticClass:"d-flex border rounded px-3 py-1 align-items-center"},[a("div",{staticClass:"ml-1 text-center",staticStyle:{flex:"1"}})])}],d=a("2b0e"),p=a("7898"),m=a.n(p);const h={name:"_blank",specs:["fullscreen=yes","titlebar=no","scrollbars=no"],styles:["https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css","https://unpkg.com/kidlat-css/css/kidlat.css"],timeout:1e3,autoClose:!0,windowTitle:window.document.title};d["default"].use(m.a,h);var f={name:"Printer",props:{value:{type:Boolean,default:!1},display:{type:Boolean,default:!1},id:{type:String,required:!0}},watch:{value(t){1==t&&0==this.proceced&&this.runPrint()}},data:()=>({proceced:!1}),methods:{async runPrint(){this.proceced=!0,await this.$htmlToPaper(this.id),this.proceced=!1,this.$emit("input")}}},v=f,b=(a("f0ac"),a("2877")),g=Object(b["a"])(v,r,u,!1,null,"4aee2ec1",null),y=g.exports,C={components:{VueEditor:l["a"],Printer:y},props:{occupation:{type:Object,required:!0}},data:()=>({print:!1,customToolbar:[[]]}),computed:{},mounted(){},methods:{setPrint(){this.print=!0}}},w=C,x=(a("1805"),Object(b["a"])(w,n,c,!1,null,"c920f0d8",null)),_=x.exports,O=a("14ff"),L=a("fb87");const T=a("5a6f");var k={name:"list-occupations",components:{OccupationForm:s["a"],Occupation:O["a"],SearchForm:L["a"],contratOccupation:_},data:()=>({title:"Ouverture du contrat de bail",action:"add",search:null,showOverlay:!0,currentPage:1,perPage:10,occupation:null,occupations:[],trueOccupations:[],provenance:1}),computed:{items(){return T.array_slice(this.occupations,this.offset,this.perPage)},offset(){return this.currentPage*this.perPage-this.perPage}},watch:{search(t){t=t.toLowerCase(),this.occupations=T.empty(t)?this.trueOccupations:this.trueOccupations.filter(e=>e.logement.refLogement.toLowerCase().includes(t)||(e.locataire.nomLocataire+" "+e.locataire.prenomLocataire).toLowerCase().includes(t))}},beforeMount(){this.getOccupations()},mounted(){setTimeout(()=>{$("#editLayoutItem").modal("hide")},100)},methods:{toogleList(){const t=$("#toogleList");t.hasClass("fa-list-alt")?t.removeClass("fa-list-alt").addClass("fa-times"):t.addClass("fa-list-alt").removeClass("fa-times"),$("#mySidenav").toggleClass("active")},goTo(t){const e=this.occupations.length;let a=this.occupations.findIndex(t=>t.idOccupation==this.occupation.idOccupation);"prev"==t?a--:a++,a>=e&&(a=0),a<0&&(a=e-1),this.selectLogement(this.occupations[a])},selectLogement(t){this.occupation=t;let e=window.location.href.split("/"),a=e[e.length-1];"occupations"==a?e.push(this.occupation.idOccupation):e[e.length-1]=this.occupation.idOccupation,window.history.pushState({},"",e.join("/")),$("#mySidenav").removeClass("active"),$("#toogleList").addClass("fa-list-alt").removeClass("fa-times")},autoDetailsTarget(){const t=this.$route.query.target||null;t&&(console.log("occupation n",t),window.history.pushState({},"","/"+t))},goToLogement(){this.$bvModal.hide("occupationForm"),setTimeout(()=>{this.$router.push({name:"logements",query:{target:"call-logement"}})},50)},gotToLocataire(){this.$bvModal.hide("occupationForm"),setTimeout(()=>{this.$router.push({name:"habitants",query:{target:"call-habitant"}})},50)},addedOccupation(){this.getOccupations(),this.$bvModal.hide("occupationForm")},getOccupations(){axios.get("occupations").then(t=>t.result||[]).then(t=>{this.occupations=this.trueOccupations=t;let e=t.findIndex(t=>t.idOccupation==this.$route.params.id);-1==e&&(e=0),this.occupation=t[e]||{},this.showOverlay=!1,this.autoDetailsTarget()})},removeOccupation(t){console.log("occupation",t)},showDetails(t){this.occupation=t,setTimeout(()=>{$("#editLayoutItem").modal("show"),$("#editLayoutItem").on("hide.bs.modal",t=>{this.occupation=null}),$("#editLayoutItem").on("hidden.bs.modal",t=>{this.occupation=null})},100)},setUpdateOccupation(t){this.action="edit",console.log("occupation",t),this.occupation=t,this.$refs["occupation-form"].show(),this.title="Edition du contrat de bail"},resetOccupationFormProps(){this.action="add",this.title="Ouverture du contrat de bail",this.$bvModal.hide("occupationForm"),this.occupation={loyer:null,mode:null,energie:"index",eau:"index",puEnergie:null,puEau:null,idLogement:null,idLocataire:null,debut:null,indexEnergie:0,indexEau:0,endLastBail:!1,avance:1,contrats:null,dureeBail:0,caution:1}}}},P=k,S=(a("2f5c"),a("681f"),Object(b["a"])(P,o,i,!1,null,"758bd15c",null));e["default"]=S.exports},1805:function(t,e,a){"use strict";a("a7ed")},"2f5c":function(t,e,a){"use strict";a("3d2b")},"3d2b":function(t,e,a){},"681f":function(t,e,a){"use strict";a("799e")},7898:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const o=(t,e)=>{e.forEach(e=>{let a=t.document.createElement("link");a.setAttribute("rel","stylesheet"),a.setAttribute("type","text/css"),a.setAttribute("href",e),t.document.getElementsByTagName("head")[0].appendChild(a)})},i={install(t,e={}){t.prototype.$htmlToPaper=(t,a={},i=(()=>!0))=>{let s="_blank",n=["fullscreen=yes","titlebar=yes","scrollbars=yes"],c=[],l=1e3,r=!0,u=window.document.title,{name:d=s,specs:p=n,styles:m=c,timeout:h=l,autoClose:f=r,windowTitle:v=u}=e;a.name&&(d=a.name),a.specs&&(p=a.specs),a.styles&&(m=a.styles),a.timeout&&(h=a.timeout),a.autoClose&&(f=a.autoClose),a.windowTitle&&(v=a.windowTitle),p=p.length?p.join(","):"";let b=t;if(("string"===typeof t||t instanceof String)&&(b=window.document.getElementById(t)),!b)return void alert(`Element to print #${t} not found!`);const g="",y=window.open(g,d,p);y.document.write(`\n        <html>\n          <head>\n            <title>${v}</title>\n          </head>\n          <body>\n            ${b.innerHTML}\n          </body>\n        </html>\n      `),o(y,m);const C=new Promise(t=>{setTimeout(()=>{y.focus(),y.print(),f&&y.document.close(),f&&y.close(),i&&i(),t()},h)});return!!i||C}}};e.default=i},"799e":function(t,e,a){},a7ed:function(t,e,a){},df2d:function(t,e,a){},f0ac:function(t,e,a){"use strict";a("df2d")}}]);
//# sourceMappingURL=chunk-48a7ef73.7e7be804.js.map