(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6fb4cc95"],{"5c21":function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"shadow list-item list-item-grid"},[i("div",{staticClass:"card d-flex flex-row mb-3"},[i("a",{staticClass:"d-flex card-img",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.showDetails.apply(null,arguments)}}},[i("img",{staticClass:"list-thumbnail responsive border-0",staticStyle:{height:"10em"},attrs:{src:a("d8af"),alt:""}}),t.isNew?i("span",{staticClass:"badge badge-pill badge-primary position-absolute badge-top-left"},[t._v("New")]):t._e()]),i("div",{staticClass:"d-flex flex-grow-1 min-width-zero card-content"},[i("div",{staticClass:"card-body align-self-center d-flex flex-column flex-md-row justify-content-between min-width-zero align-items-md-center"},[i("div",{staticClass:"text-center"},[i("h4",{staticClass:"text-red mt-0 truncate"},[t._v(t._s(t.batiment.nomBatiment))]),i("span",{staticClass:"d-inline-block text-muted"},[t._v("Reference: "),i("b",[t._v(t._s(t.batiment.refBatiment))])])]),t.isSub?i("p",{staticClass:"text-muted mt-3 mb-1 date w-15 w-xs-100 text-small"},[t._v(t._s(t.$date(t.batiment.createdAt).format("DD.MM.YYYY")))]):i("p",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.bottom",value:t.dateCreation,expression:"dateCreation",modifiers:{bottom:!0}}],staticClass:"mt-3 mb-1 text-muted text-small date w-15 w-xs-100"},[t._v(t._s(t.$date(t.batiment.createdAt).format("DD.MM.YYYY")))])]),i("div",{staticClass:"list-actions"},[t.isSub?t._e():i("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.showDetails.apply(null,arguments)}}},[i("i",{staticClass:"ik ik-eye"})]),t.isSub?i("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.accessTo.apply(null,arguments)}}},[i("i",{staticClass:"ik ik-link"})]):t._e(),t.isSub?t._e():i("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.$emit("makeUpdate",t.batiment)}}},[i("i",{staticClass:"ik ik-edit-2"})]),i("a",{staticClass:"list-delete",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.remove.apply(null,arguments)}}},[i("i",{staticClass:"ik ik-trash-2"})])])])])])},s=[],n={props:{batiment:{type:Object,required:!0},isSub:{type:Boolean,default:!1}},computed:{dateCreation(){const t=this.$date(this.batiment.createdAt);return`Créée le ${t.format("dddd, DD MMMM YYYY")} à ${t.format("HH:mm")}`},isNew(){return dayjs().diff(this.batiment.createdAt,"week")<=1}},methods:{showDetails(){if(this.isSub)return!1;this.$emit("showDetails",this.batiment)},accessTo(){$("#editLayoutItem").modal("hide"),this.$router.push({name:"batiments",query:{target:this.batiment.idBatiment}})},remove(){App.confirm(`Voullez vous vraiment supprimer le batiment " <b>${this.batiment.nomBatiment}</b> " ?`,{confirm:()=>{axios.delete("batiments/"+this.batiment.idBatiment).then(t=>t.success?(this.$emit("deleted",this.batiment.idBatiment),App.notifySuccess(t.message)):App.notifyError(t.message)).catch(t=>{App.notifyError(t.message)})}})}}},o=n,l=a("2877"),r=Object(l["a"])(o,i,s,!1,null,null,null);e["a"]=r.exports},"91d3":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("page-description",{attrs:{title:"Batiments",description:"Gestion de vos batiments",icon:"building",path:["Patrimoine immobilier","Mes batiments"]}}),a("div",{staticClass:"row"},[a("div",{staticClass:"col-md-12"},[a("div",{staticClass:"mb-2 clearfix"},[a("div",{staticClass:"collapse d-md-block display-options",attrs:{id:"displayOptions"}},[a("div",{staticClass:"d-block d-md-inline-block"},[a("div",{staticClass:"search-sm d-inline-block float-md-left mr-1 mb-1 align-top"},[a("form",{attrs:{action:"",onSubmit:"return false"}},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.search,expression:"search"}],staticClass:"form-control",attrs:{type:"text",placeholder:"Recherche..."},domProps:{value:t.search},on:{input:function(e){e.target.composing||(t.search=e.target.value)}}}),t._m(0)])])]),a("div",{staticClass:"float-md-right"},[a("b-button",{attrs:{variant:"danger"},on:{click:function(e){return e.preventDefault(),function(){t.modal.action="add",t.$bvModal.show("modal-batiment")}.apply(null,arguments)}}},[a("i",{staticClass:"fa fa-plus-circle"}),t._v(" Nouveau batiment")])],1)])]),a("div",{staticClass:"separator mb-20"}),a("b-overlay",{attrs:{show:t.showOverlay,rounded:"sm"}},[t.batiments.length?a("b-row",{staticClass:"layout-wrap"},t._l(t.items,(function(e,i){return a("b-col",{key:e.idBatiment||i,staticClass:"animated flipInX mb-4",attrs:{xl:"3",lg:"4",cols:"12",sm:"6"}},[a("batiment",{attrs:{batiment:e},on:{makeUpdate:t.updateBatiment,deleted:t.removeBatiment,showDetails:t.showDetails}})],1)})),1):a("b-alert",{staticClass:"text-center",attrs:{variant:"info",show:""}},[a("i",{staticClass:"fa fa-exclamation-triangle fa-3x"}),t._v(" "),a("br"),a("span",{staticClass:"h4 d-inline-flex ml-2"},[t._v("Aucun batiment trouvé")])]),a("paginator",{attrs:{hr:"top",offset:t.offset,total:t.batiments.length,limit:t.perPage,page:t.currentPage},on:{pageChanged:function(e){t.currentPage=e},limitChanged:function(e){t.perPage=e}}})],1)],1)]),t.batiment?a("div",{staticClass:"modal fade edit-layout-modal",attrs:{id:"editLayoutItem",tabindex:"-1",role:"dialog","aria-labelledby":"editLayoutItemLabel","aria-hidden":"true"}},[a("div",{staticClass:"modal-dialog",attrs:{role:"document"}},[a("div",{staticClass:"modal-content"},[a("div",{staticClass:"modal-header"},[a("h5",{staticClass:"modal-title",attrs:{id:"editLayoutItemLabel"}},[t._v("Détails du batiment : "),a("b",[t._v(t._s(t.batiment.nomBatiment))]),t._v(".")]),t._m(1)]),a("div",{staticClass:"modal-body pt-2"},[a("details-batiment",{attrs:{batiment:t.batiment},on:{logementsChanged:t.changeLogements}})],1)])])]):t._e(),a("b-modal",{attrs:{id:"modal-batiment",size:"sm","ok-only":"","ok-title":"Valider"},on:{hidden:t.resetModal,ok:t.submitModal},scopedSlots:t._u([{key:"modal-title",fn:function(){return["add"==t.modal.action?a("span",[t._v("Ajouter un batiment")]):t._e(),"edit"==t.modal.action?a("span",[t._v("Edition du batiment")]):t._e()]},proxy:!0}])},[a("b-form-group",{attrs:{label:"Cité"}},[a("b-form-select",{attrs:{options:t.cites},model:{value:t.modal.idCite,callback:function(e){t.$set(t.modal,"idCite",e)},expression:"modal.idCite"}})],1),a("b-form-group",{attrs:{label:"Nom du batiment"}},[a("b-form-input",{attrs:{placeholder:"Ex: Batiment A",trim:""},model:{value:t.modal.nom,callback:function(e){t.$set(t.modal,"nom",e)},expression:"modal.nom"}})],1),a("b-form-group",{attrs:{label:"Reference"}},[a("b-form-input",{attrs:{placeholder:"Ex: B1",trim:""},model:{value:t.modal.ref,callback:function(e){t.$set(t.modal,"ref",e)},expression:"modal.ref"}})],1)],1)],1)},s=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("button",{staticClass:"btn btn-icon",attrs:{type:"submit"}},[a("i",{staticClass:"ik ik-search"})])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal","aria-label":"Close"}},[a("span",{attrs:{"aria-hidden":"true"}},[t._v("×")])])}],n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("ul",{staticClass:"nav nav-tabs"},[a("li",{staticClass:"nav-item"},[a("a",{staticClass:"nav-link",class:{active:"logements"==t.section},attrs:{"data-toggle":"tab",href:"#"},on:{click:function(e){e.preventDefault(),t.section="logements"}}},[t._v("Logements")])]),a("li",{staticClass:"nav-item"},[a("a",{staticClass:"nav-link",class:{active:"stats"==t.section},attrs:{"data-toggle":"tab",href:"#"},on:{click:function(e){e.preventDefault(),t.section="stats"}}},[t._v("Statistiques générales")])]),a("li",{staticClass:"nav-item"},[a("a",{staticClass:"nav-link",class:{active:"add-logement"==t.section},attrs:{"data-toggle":"tab",href:"#"},on:{click:function(e){e.preventDefault(),t.section="add-logement"}}},[t._v("Ajouter un logement")])]),a("li",{staticClass:"nav-item"},[a("a",{staticClass:"nav-link",class:{active:"depenses"==t.section},attrs:{"data-toggle":"tab",href:"#"},on:{click:function(e){e.preventDefault(),t.section="depenses"}}},[t._v("Dépenses liées au batiment")])])]),a("div",{staticClass:"tab-content mt-3"},[a("div",{staticClass:"tab-pane fade show active"},["stats"==t.section?a("div",{staticClass:"jumbotron pt-10 pb-10"},[a("h3",{staticClass:"m-0"},[t._v("Statistiques générales")]),a("p",[t._v("This is a simple hero unit, a simple jumbotron-style component for calling extra attention to featured content or information.")])]):t._e(),"logements"==t.section?a("div",[t.batiment.logements.length?a("div",{staticStyle:{height:"75vh"}},[a("paginator",{attrs:{"no-control":"",hr:"bottom",total:t.batiment.logements.length,limit:t.perPage,page:t.currentPage},on:{pageChanged:function(e){t.currentPage=e},limitChanged:function(e){t.perPage=e}}}),a("div",{staticStyle:{height:"90%","overflow-y":"auto","overflow-x":"hidden"}},[a("b-row",{staticClass:"layout-wrap"},t._l(t.items,(function(e,i){return a("b-col",{key:e.idLogement||i,attrs:{cols:"6"}},[a("logement",{attrs:{logement:e,"is-sub":""},on:{deleted:t.removeLogement}})],1)})),1)],1)],1):a("b-alert",{attrs:{variant:"info",show:""}},[a("i",{staticClass:"fa fa-exclamation-triangle fa-3x float-left"}),a("span",{staticClass:"h4 d-inline-flex ml-2"},[t._v("Aucun logement enregistré pour le moment")])])],1):t._e(),a("div",{directives:[{name:"show",rawName:"v-show",value:"add-logement"==t.section,expression:"section == 'add-logement'"}]}),"depenses"==t.section?a("div",[t.batiment.depenses.length?t._e():a("b-alert",{attrs:{variant:"info",show:""}},[a("i",{staticClass:"fa fa-exclamation-triangle fa-3x float-left"}),a("span",{staticClass:"h4 d-inline-flex ml-2"},[t._v("Aucune dépense enregistrée pour le moment")])]),t.batiment.depenses.length>0?a("div",{staticStyle:{height:"75vh"}},[a("b-row",[a("paginator",{attrs:{"no-control":"",hr:"bottom",total:t.batiment.depenses.length,limit:t.perPage,page:t.currentPage},on:{pageChanged:function(e){t.currentPage=e},limitChanged:function(e){t.perPage=e}}})],1),a("div",{staticStyle:{height:"90%","overflow-y":"auto","overflow-x":"hidden"}},[a("b-row",{staticClass:"layout-wrap"},t._l(t.itemsDepenses,(function(e,i){return a("b-col",{key:e.idDepense||i,attrs:{cols:"6"}},[a("depense",{attrs:{depense:e,source:t.source,"is-sub":""},on:{deleted:t.removeDepense}})],1)})),1)],1),t.commandeDepense?a("depense-form",{attrs:{action:t.action,batiment:t.batiment},on:{depenseAdded:t.pushDepense,closeDepenseModal:t.onCloseSet}}):t._e()],1):t._e(),a("div",[a("b-button",{directives:[{name:"b-modal",rawName:"v-b-modal.modal-lg",modifiers:{"modal-lg":!0}}],attrs:{variant:"danger"},on:{click:function(e){return e.preventDefault(),t.defineDepense.apply(null,arguments)}}},[a("i",{staticClass:"fa fa-plus-circle"}),t._v(" Nouvelle dépense ")])],1)],1):t._e()])])])},o=[],l=a("265a"),r=a("5ad6"),m=a("a474");const d=a("5a6f");var c={props:{batiment:{type:Object,required:!0}},components:{Logement:l["a"],Depense:r["a"],DepenseForm:m["a"]},computed:{items(){return d.array_slice(this.batiment.logements,this.offset,this.perPage)},itemsDepenses(){return d.array_slice(this.batiment.depenses||[],this.offset,this.perPage)},offset(){return this.currentPage*this.perPage-this.perPage}},data:()=>({section:"logements",submitted:!1,commandeDepense:!1,action:"",currentPage:1,perPage:10,source:3}),mounted(){},methods:{removeLogement(t){this.batiment.logements=this.batiment.logements.filter(e=>e.idLogement!=t),this.$emit("logementsChanged",this.batiment.logements)},removeDepense(t){this.batiment.depenses=this.batiment.depenses.filter(e=>e.idDepense!=t),this.$emit("depensesChanged",this.batiment.depenses)},defineDepense(){this.action="add",this.commandeDepense=!0},onCloseSet(){this.commandeDepense=!1}}},u=c,h=a("2877"),p=Object(h["a"])(u,n,o,!1,null,null,null),b=p.exports,f=a("5c21");const g=a("5a6f");var v={name:"Batiments",components:{DetailsBatiment:b,Batiment:f["a"]},computed:{items(){return g.array_slice(this.batiments,this.offset,this.perPage)},offset(){return this.currentPage*this.perPage-this.perPage}},data:()=>({batiments:[],cites:[],trueBatiments:[],showOverlay:!0,batiment:null,currentPage:1,perPage:10,search:null,modal:{action:"",nom:"",ref:"",idBatiment:"",idCite:""}}),watch:{search(t){g.empty(t)?this.batiments=this.trueBatiments:this.batiments=this.trueBatiments.filter(e=>e.nomBatiment.toLowerCase().includes(t.toLowerCase()))}},beforeMount(){},mounted(){this.getBatiments()},methods:{async getBatiments(){try{this.batiments=this.trueBatiments=await axios.get("batiments").then(t=>t.result||[]),this.showOverlay=!1,this.cites=(await axios.get("cites").then(t=>t.result||[])).map(t=>({value:t.idCite,text:t.nomCite})),this.autoDetailsTarget()}catch(t){}},autoDetailsTarget(){const t=this.$route.query.target||null;if(t){const e=this.trueBatiments.filter(e=>e.idBatiment==t)[0];e&&(this.showDetails(e),window.history.replaceState({},"",window.location.href.split("?")[0]))}},showDetails(t){this.batiment=t,setTimeout(()=>{$("#editLayoutItem").modal("show"),$("#editLayoutItem").on("hide.bs.modal",t=>{this.batiment=null}),$("#editLayoutItem").on("hidden.bs.modal",t=>{this.batiment=null})},100)},changeLogements(t){this.batiments=this.batiments.map(e=>e.idBatiment!=this.batiment.idBatiment?e:{...e,logements:t}),this.batiment.logements=t},removeBatiment(t){this.batiments=this.batiments.filter(e=>e.idBatiment!=t),this.trueBatiments=this.trueBatiments.filter(e=>e.idBatiment!=t)},resetModal(){this.modal={action:"",nom:"",ref:"",idBatiment:"",idCite:""}},submitModal(t){if(t.preventDefault(),g.empty(this.modal.nom)||g.empty(this.modal.ref))return App.error("Veuillez remplir tous les champs du formulaire");"add"==this.modal.action&&axios.post("batiments",this.modal).then(t=>t.success?(this.batiments=this.addNewBatiment(this.batiments,t.result),this.trueBatiments=this.addNewBatiment(this.trueBatiments,t.result),this.$bvModal.hide("modal-batiment"),App.notifySuccess(t.message)):App.alertError(t.message)).catch(t=>{App.notifyError(t.message)}),"edit"==this.modal.action&&axios.put("batiments/"+this.modal.idBatiment,this.modal).then(t=>t.success?(this.batiments=this.renameBatiment(this.batiments,this.modal),this.trueBatiments=this.renameBatiment(this.trueBatiments,this.modal),this.$bvModal.hide("modal-batiment"),App.notifySuccess(t.message)):App.alertError(t.message)).catch(t=>{App.notifyError(t.message)})},updateBatiment(t){this.modal={action:"edit",nom:t.nomBatiment,ref:t.refBatiment,idBatiment:t.idBatiment,idCite:t.idCite},this.$bvModal.show("modal-batiment")},addNewBatiment(t,e){let a=!1;for(let i=0;i<t.length;i++)if(t[i].idBatiment==e.idBatiment){a=!0;break}return a||t.push(e),t},renameBatiment(t,e){return t.map(t=>(t.idBatiment==e.idBatiment&&(t.nomBatiment=e.nom,t.refBatiment=e.ref),t))}}},C=v,w=Object(h["a"])(C,i,s,!1,null,null,null);e["default"]=w.exports},d8af:function(t,e,a){t.exports=a.p+"img/logement.efd92594.jpg"}}]);
//# sourceMappingURL=chunk-6fb4cc95.2934c37a.js.map