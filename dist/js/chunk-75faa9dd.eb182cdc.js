(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-75faa9dd"],{"02e8":function(e,t,s){},"287a":function(e,t,s){"use strict";s("02e8")},"2c43":function(e,t,s){"use strict";t["a"]={success:function(e,t){this.make(e,{type:"success",bgcolor:"#5bd747"},t)},error:function(e,t){this.make(e,{type:"error"},t)},make:function(e,t,s){notif(Object.assign({},{type:"info",msg:e,timeout:3e3,callback:s},t))}}},"5ad6":function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"card d-flex flex-row justify-justify-content-start align-items-start"},[s("a",{staticClass:"d-flex card-img",attrs:{href:"#editLayoutItem","data-toggle":"modal","data-target":"#editLayoutItem"}},[s("img",{staticClass:"list-thumbnail responsive border-0",staticStyle:{height:"10em"},attrs:{src:e.depense.photo||"/img/depenseImage.jpg",alt:""}})]),s("div",{staticClass:"d-flex flex-grow-1 min-width-zero card-content"},[s("div",{staticClass:"card-body align-self-center d-flex flex-column justify-content-between min-width-zero align-items-md-center"},[s("div",{staticClass:"list-item-heading mb-1 truncate w-100 w-xs-100",attrs:{href:"#editLayoutItem","data-toggle":"modal","data-target":"#editLayoutItem"}},[s("h5",{staticClass:"text-red"},[e._v(e._s(e.php.ucfirst(e.depense.motif.toLowerCase())))]),s("div",{staticClass:"d-flex"},[s("span",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.bottom",value:"Montant de la dépense",expression:"'Montant de la dépense'",modifiers:{bottom:!0}}],staticClass:"text-muted small date mr-3"},[s("i",{staticClass:"fa fa-dollar-sign"}),e._v(" "+e._s(e.depense.montant)+" F")]),s("span",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.bottom",value:"Date de l'opération",expression:"'Date de l\\'opération'",modifiers:{bottom:!0}}],staticClass:"text-muted small date ml-3"},[s("i",{staticClass:"far fa-calendar-alt"}),e._v(" "+e._s(e.$dayjs(e.depense.dateDepense).format("DD MMMM YYYY"))+" ")])]),s("div",{staticClass:"w-100"},[e.depense.etatDepense?s("span",{staticClass:"badge badge-pill badge-success"}):s("span",{staticClass:"badge badge-danger small"},[e._v("Non traitée")])])]),s("div",{staticClass:"card-content w-100"},[s("hr"),0==e.source?s("div",[null!==e.depense.cite?s("div",{staticClass:"text-muted w-100 my-1"},[e._m(0),s("span",[e._v("Cité :"+e._s(e.depense.cite.nomCite)+" ")])]):e._e(),null!==e.depense.batiment?s("div",{staticClass:"text-muted w-100 my-1"},[e._m(1),s("span",[e._v("Batiment :"+e._s(e.depense.batiment.nomBatiment)+" ")])]):e._e(),null!==e.depense.logement?s("div",{staticClass:"text-muted w-100 my-1"},[e._m(2),s("span",[e._v("Logement :"+e._s(e.depense.logement.refLogement)+" ")])]):e._e()]):e._e(),e.depense.observation?s("div",{staticClass:"jumbotron pt-5 pb-5 px-3 my-0"},[s("p",{staticClass:"text-muted text-small"},[e._v(e._s(e.depense.observation))])]):e._e()])]),s("div",{staticClass:"list-actions"},[e.isSub?e._e():s("a",{attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.showDetails.apply(null,arguments)}}},[s("i",{staticClass:"ik ik-eye"})]),e.isSub?s("a",{attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.accessTo.apply(null,arguments)}}},[s("i",{staticClass:"ik ik-link"})]):e._e(),e.isSub?e._e():s("a",{attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.$emit("makeUpdate",e.depense)}}},[s("i",{staticClass:"ik ik-edit-2"})]),s("a",{staticClass:"list-delete",attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.remove.apply(null,arguments)}}},[s("i",{staticClass:"ik ik-trash-2"})])])])])},i=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("span",{staticClass:"d-inline-block w-10 text-center"},[s("i",{staticClass:"fas fa-city"})])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("span",{staticClass:"d-inline-block w-10 text-center"},[s("i",{staticClass:"fa fa-building"})])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("span",{staticClass:"d-inline-block w-10 text-center"},[s("i",{staticClass:"fas fa-home"})])}];const n=s("5a6f");var o={props:{depense:{type:Object,required:!0},isSub:{type:Boolean,default:!1},source:{type:Number,default:0}},computed:{dateCreation(){const e=this.$date(this.depense.createdAt);return`Crée le ${e.format("dddd, DD MMMM YYYY")} à ${e.format("HH:mm")}`},php(){return n}},methods:{showDetails(){if(this.isSub)return!1;this.$emit("showDetails",this.depense)},accessTo(){$("#editLayoutItem").modal("hide"),this.$router.push({name:"depenses",query:{target:this.depense.idDepense}})},remove(){App.confirm(`Voullez vous vraiment supprimer la dépense " <b>${this.depense.motif}</b> " ?`,{confirm:()=>{axios.delete("depenses/"+this.depense.idDepense).then(e=>e.success?(this.$emit("deleted",this.depense.idDepense),App.notifySuccess(e.message)):App.notifyError(e.message))}})}}},l=o,r=s("2877"),d=Object(r["a"])(l,a,i,!1,null,null,null);t["a"]=d.exports},"97be":function(e,t,s){"use strict";s("e0aa")},a474:function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("b-overlay",{attrs:{show:e.showOverlayP,rounded:"sm"}},[s("b-row",[s("b-col",[s("b-form-group",{attrs:{label:"Montant",description:"à combien s'élève la dépense éffectuée?"}},[s("b-form-input",{attrs:{placeholder:"Ex: 45000",type:"number",trim:""},model:{value:e.depense.montant,callback:function(t){e.$set(e.depense,"montant",t)},expression:"depense.montant"}})],1)],1),s("b-col",[s("b-form-group",{attrs:{label:"Date à laquelle la dépense a été éffectuée"}},[s("date-picker",{staticClass:"w-100",attrs:{placeholder:"Selectionnez une date",format:"dddd, DD MMMM YYYY",valueType:"YYYY-MM-DD",clearable:!1},model:{value:e.depense.date,callback:function(t){e.$set(e.depense,"date",t)},expression:"depense.date"}})],1)],1)],1),s("b-row",[s("b-col",[s("b-form-group",{attrs:{label:"Motif",description:"Pourquoi avez-vous éffectué cette dépense ?"}},[s("b-form-input",{attrs:{placeholder:"Ex: Replacement ampoules cassées",trim:""},model:{value:e.depense.motif,callback:function(t){e.$set(e.depense,"motif",t)},expression:"depense.motif"}})],1)],1),s("b-col",[s("b-form-group",{attrs:{label:"responsable",description:"Qui est celui qui a déclaré la dépense?"}},[s("b-form-input",{attrs:{placeholder:"Ex: Pedro",trim:""},model:{value:e.depense.responsable,callback:function(t){e.$set(e.depense,"responsable",t)},expression:"depense.responsable"}})],1)],1)],1),s("b-row",[s("b-col",{attrs:{cols:"7"}},[s("b-form-group",{attrs:{label:"observations"}},[s("b-form-textarea",{staticClass:"mb-2",attrs:{placeholder:"C'est ici que vou pouvez décrire ce qui a engendré la dépense",rows:"7"},model:{value:e.depense.observation,callback:function(t){e.$set(e.depense,"observation",t)},expression:"depense.observation"}})],1)],1),s("b-col",{attrs:{cols:"5"}},[s("b-form-group",{attrs:{label:"joindre une photo"}},[s("img-inputer",{attrs:{theme:"light",size:"xl","bottom-text":"déposez le fichier ici ou cliquez pour modifier",icon:"img",placeholder:"joindre recu dépense"},on:{onChange:e.onrecuLoad},model:{value:e.depense.photo,callback:function(t){e.$set(e.depense,"photo",t)},expression:"depense.photo"}})],1)],1)],1),s("b-overlay",{attrs:{show:e.showOverlay,rounded:"sm"}},[s("b-row",[s("b-col",[s("b-form-group",{attrs:{label:"Votre dépense concerne"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.ariaDescribedby;return[s("b-form-radio-group",{attrs:{id:"radio-slots",options:e.options,"aria-describedby":a,name:"radio-options-slots",disabled:e.disableState},on:{change:e.setAction},model:{value:e.commandeAction,callback:function(t){e.commandeAction=t},expression:"commandeAction"}})]}}])})],1),s("b-col",[s("transition",{attrs:{"enter-active-class":"animated zoomIn"}},[e.showSelectCite?s("div",{staticClass:"form-group"},[s("label",[e._v("Cité concernée")]),s("v-select",{class:{disabled:1==e.disabled},attrs:{label:"nomCite",options:e.cites},model:{value:e.id,callback:function(t){e.id=t},expression:"id"}})],1):e._e(),e.showSelectBatiment?s("div",{staticClass:"form-group"},[s("label",[e._v("Batiment concerné")]),s("v-select",{class:{disabled:1==e.disabled},attrs:{label:"nomBatiment",options:e.batiments},model:{value:e.id,callback:function(t){e.id=t},expression:"id"}})],1):e._e(),e.showSelectLogement?s("div",{staticClass:"form-group"},[s("label",[e._v("Logement concerné")]),s("v-select",{class:{disabled:1==e.disabled},attrs:{label:"refLogement",options:e.logements},model:{value:e.id,callback:function(t){e.id=t},expression:"id"}})],1):e._e()])],1)],1),s("hr"),s("div",{staticClass:"float-right"},["2"==e.provenance?s("b-button",{staticClass:"mr-1",on:{click:function(t){return t.preventDefault(),e.$emit("cancel")}}},[e._v("Annuler")]):e._e(),s("b-button",{attrs:{variant:"danger"},on:{click:function(t){return t.preventDefault(),e.submitModal.apply(null,arguments)}}},[e._v("Valider")])],1)],1)],1)},i=[],n=s("ec45"),o=(s("411c"),s("0edd"),s("2c43")),l=s("2b0e"),r=s("657c");s("2bd9");const d=s("5a6f");l["default"].component("ImgInputer",r["a"]);var c={name:"depense-form",data:()=>({disabled:!1,disableState:!1,options:[{text:"une cité",value:"cite"},{text:"un batiment",value:"batiment"},{text:"un logement",value:"logement"}],depense:{montant:"",date:"",motif:"",responsable:"",obs:"",photo:""},id:"",commandeAction:"",showOverlay:!1,showOverlayP:!1,showSelectCite:!1,showSelectBatiment:!1,showSelectLogement:!1,sendForm:!1,cites:[],batiments:[],logements:[]}),components:{DatePicker:n["default"]},props:{cite:{type:Object},batiment:{type:Object},logement:{type:Object},action:{type:String,required:!0,default:"add"},provenance:{type:String,required:!0,default:"1"}},methods:{async onrecuLoad(e){const t=e;this.depense.photo=await this.getBase64(t)},async setAction(){if(this.showOverlay=!0,"cite"==this.commandeAction){this.showSelectCite=!0,this.showSelectBatiment=!1,this.showSelectLogement=!1;try{this.cites=await(await axios.get("cites").then(e=>e.result))}catch(e){console.log(e)}}if("batiment"==this.commandeAction){this.showSelectBatiment=!0,this.showSelectCite=!1,this.showSelectLogement=!1;try{this.batiments=await(await axios.get("batiments").then(e=>e.result))}catch(e){console.log(e)}}if("logement"==this.commandeAction){this.showSelectLogement=!0,this.showSelectCite=!1,this.showSelectBatiment=!1;try{this.logements=await(await axios.get("logements").then(e=>e.result))}catch(e){console.log(e)}}this.showOverlay=!1},resetModal(){this.depense={montant:"",date:"",motif:"",responsable:"",observation:""},"2"!=this.provenance&&(this.showSelectCite=!1,this.showSelectBatiment=!1,this.showSelectLogement=!1,this.id=null,this.commandeAction=""),setTimeout(()=>{this.$emit("closeDepenseModal")},500)},submitModal(e){return e.preventDefault(),d.empty(this.depense.montant)||d.empty(this.depense.motif)||d.empty(this.id)?App.error("Un montant, un motif et l'entité concernée par la dépense sont obligatoires"):""==this.depense.montant?App.error("Vous devez spécifier un montant"):""==this.depense.motif?App.error("Vous devez spécifier un motif"):""==this.id?App.error("Vous devez spécifier l'entité concernée par la dépense"):void("add"==this.action&&(this.showOverlayP=!0,this.showSelectLogement&&(console.log("dépense",this.depense,"id",this.id.idLogement),axios.post("/logements/"+this.id.idLogement+"/depenses",this.depense).then(e=>(this.resetModal(),this.showOverlayP=!1,this.$emit("depenseAdded",e.result),App.notifySuccess(e.message))).catch(e=>{this.showOverlayP=!1,o["a"].error(e.message)})),this.showSelectCite&&axios.post("/cites/"+this.id.idCite+"/depenses",this.depense).then(e=>(this.resetModal(),this.showOverlayP=!1,this.$emit("depenseAdded",e.result),App.notifySuccess(e.message))).catch(e=>{this.showOverlayP=!1,o["a"].error(e.message)}),this.showSelectBatiment&&axios.post("/batiments/"+this.id.idBatiment+"/depenses",this.depense).then(e=>(this.resetModal(),this.showOverlayP=!1,this.$emit("depenseAdded",e.result),App.notifySuccess(e.message))).catch(e=>{this.showOverlayP=!1,o["a"].error(e.message)})))},getBase64(e){return new Promise((t,s)=>{const a=new FileReader;a.readAsDataURL(e),a.onload=()=>t(a.result),a.onerror=e=>s(e)})}},mounted(){null!=this.cite&&(this.commandeAction="cite",this.showSelectCite=!0,this.id=this.cite,this.disabled=!0,this.disableState=!0),null!=this.batiment&&(this.commandeAction="batiment",this.showSelectBatiment=!0,this.id=this.batiment,this.disabled=!0,this.disableState=!0),null!=this.logement&&(this.commandeAction="logement",this.showSelectLogement=!0,this.id=this.logement,this.disabled=!0,this.disableState=!0)}},p=c,m=(s("287a"),s("2877")),u=Object(m["a"])(p,a,i,!1,null,"47a744a2",null);t["a"]=u.exports},c574:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"container-fluid"},[s("page-description",{attrs:{path:[{label:"Mes depenses",route:"depenses"}]}}),s("div",{staticClass:"row"},[s("div",{staticClass:"col-md-12"},[s("div",{staticClass:"mb-2 clearfix"},[s("div",{staticClass:"collapse d-md-block display-options",attrs:{id:"displayOptions"}},[s("div",{staticClass:"d-block d-md-inline-block"},[s("div",{staticClass:"btn-group float-md-left mr-1 mb-1"},[s("b-form-select",{staticStyle:{"box-shadow":"none",height:"40px",width:"260px"},model:{value:e.filtre_categories,callback:function(t){e.filtre_categories=t},expression:"filtre_categories"}},[s("b-form-select-option",{attrs:{value:null}},[e._v("Filtre de catégories")]),s("b-form-select-option-group",[s("b-form-select-option")],1)],1)],1),s("SearchForm",{model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1),s("div",{staticClass:"float-md-right"},[s("btnAdd",{directives:[{name:"b-modal",rawName:"v-b-modal.depenseForm",modifiers:{depenseForm:!0}}],attrs:{message:"Ajouter une dépense"}})],1)])]),s("div",{staticClass:"separator mb-20"}),s("b-overlay",{attrs:{show:e.showOverlay,rounded:"sm"}},[e.depenses.length?s("b-row",{staticClass:"layout-wrap"},e._l(e.depenses,(function(t,a){return s("div",{key:t.idDepense||a,staticClass:"col-6 list-item list-item-thumb animated flipInX mb-2"},[s("depense",{attrs:{depense:t,soure:e.source},on:{makeUpdate:e.updateDepense,deleted:e.removeDepense,showDetails:e.showDetails}})],1)})),0):s("b-alert",{staticClass:"text-center",attrs:{variant:"info",show:""}},[s("i",{staticClass:"fa fa-exclamation-triangle fa-3x"}),s("br"),s("span",{staticClass:"h4 d-inline-flex ml-2"},[e._v("Aucune dépense enregistrée pour le moment")])]),s("paginator",{attrs:{hr:"top",offset:e.offset,total:e.depenses.length||0,limit:e.perPage,page:e.currentPage},on:{pageChanged:function(t){e.currentPage=t},limitChanged:function(t){e.perPage=t}}})],1)],1)]),e.depense?s("div",{staticClass:"modal fade edit-layout-modal",attrs:{id:"editLayoutItem",tabindex:"-1",role:"dialog","aria-labelledby":"editLayoutItemLabel","aria-hidden":"true"}},[s("div",{staticClass:"modal-dialog",attrs:{role:"document"}},[s("div",{staticClass:"modal-content"},[s("div",{staticClass:"modal-header"},[s("h5",{staticClass:"modal-title",attrs:{id:"editLayoutItemLabel"}},[e._v(" Détails de la dépense: "),s("b",[e._v(e._s(e.depense.motif))]),e._v(". ")]),e._m(0)]),s("div",{staticClass:"modal-body pt-2"},[s("details-depense",{attrs:{depense:e.depense}})],1)])])]):e._e(),s("b-modal",{attrs:{id:"depenseForm",size:"lg","hide-footer":"","no-close-on-backdrop":""},scopedSlots:e._u([{key:"modal-title",fn:function(){return[s("span",{staticClass:"ml-4 text-form-depense"},[e._v(e._s(e.title))])]},proxy:!0}])},[s("div",[s("depense-form",{attrs:{action:e.action},on:{depenseAdded:e.pushDepense}})],1)])],1)},i=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal","aria-label":"Close"}},[s("span",{attrs:{"aria-hidden":"true"}},[e._v("×")])])}],n=s("a474"),o=s("5ad6"),l=s("fb87");const r=s("5a6f");var d={name:"depenses",components:{DepenseForm:n["a"],Depense:o["a"],SearchForm:l["a"]},data:()=>({cite:null,batiment:null,logement:null,source:0,title:"Définir une dépense",search:null,showOverlay:!0,currentPage:1,perPage:10,action:"add",depenses:[],trueDepenses:[],depense:null,typesLogements:[],filtre_categories:null}),computed:{items(){return r.array_slice(this.depenses,this.offset,this.perPage)},offset(){return this.currentPage*this.perPage-this.perPage}},watch:{filtre_categories(e){this.depenses=r.empty(e)?this.trueDepenses:this.trueDepenses.filter(t=>t.idSousType==e)},search(e){console.log(this.depenses),this.depenses=r.empty(e)?this.trueDepenses:this.trueDepenses.filter(t=>t.motif.toLowerCase().includes(e.toLowerCase()))}},beforeMount(){this.getDepenses()},mounted(){},methods:{pushDepense(){this.getDepenses(),this.$bvModal.hide("depenseForm")},async getDepenses(e){this.showOverlay=!0,this.depenses=this.trueDepenses=await axios.get("depenses").then(e=>e.result||[]),this.showOverlay=!1,!1!==e&&(this.cites=await axios.get("cites").then(e=>e.result||[])),this.autoDetailsTarget()},autoDetailsTarget(){const e=this.$route.query.target||null;if(e){const t=this.trueDepenses.filter(t=>t.idDepense==e)[0];t&&(this.showDetails(t),window.history.replaceState({},"",window.location.href.split("?")[0]))}},updateDepense(e){console.log("depense",e)},removeDepense(e){console.log("depense",e)},showDetails(e){this.depense=e,setTimeout(()=>{$("#editLayoutItem").modal("show"),$("#editLayoutItem").on("hide.bs.modal",e=>{this.depense=null}),$("#editLayoutItem").on("hidden.bs.modal",e=>{this.depense=null})},100)}}},c=d,p=(s("97be"),s("2877")),m=Object(p["a"])(c,a,i,!1,null,"7563bd17",null);t["default"]=m.exports},e0aa:function(e,t,s){},fb87:function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"search-sm d-inline-block float-md-left mr-1 mb-1 align-top"},[s("form",{attrs:{action:"",onSubmit:"return false"}},[s("b-form-input",{staticStyle:{height:"40px",width:"350px","border-radius":"5px"},attrs:{type:"text",placeholder:e.placeholder},on:{input:function(t){e.$emit("input",t)}},model:{value:e.val,callback:function(t){e.val=t},expression:"val"}}),e._m(0)],1)])},i=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("button",{staticClass:"btn btn-icon",staticStyle:{height:"40px",width:"50px"},attrs:{type:"submit"}},[s("i",{staticClass:"ik ik-search"})])}],n={name:"SearchForm",props:{placeholder:{type:String,default:"Rechercher..."},value:{default:null}},data:()=>({val:null}),mounted:()=>{console.log("ldldldld:  this.value"),console.log(JSON.parse(JSON.stringify((void 0).value)))}},o=n,l=s("2877"),r=Object(l["a"])(o,a,i,!1,null,"394c7419",null);t["a"]=r.exports}}]);
//# sourceMappingURL=chunk-75faa9dd.eb182cdc.js.map