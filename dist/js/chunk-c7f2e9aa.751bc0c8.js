(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c7f2e9aa"],{"0628":function(e,t,a){"use strict";a("66d5")},"0e80":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"container-fluid"},[a("page-description",{attrs:{title:"Occupations",description:"Gestion de vos occupations",icon:"fas fa-users",path:["Gestion Immobilière","Mes Occupations"]}}),a("div",{staticClass:"row"},[a("div",{staticClass:"col-md-12"},[a("div",{staticClass:"mb-2 clearfix"},[a("div",{staticClass:"collapse d-md-block display-options",attrs:{id:"displayOptions"}},[a("div",{staticClass:"d-block d-md-inline-block"},[a("div",{staticClass:"search-sm d-inline-block float-md-left mr-1 mb-1 align-top"},[a("form",{attrs:{action:"",onSubmit:"return false"}},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.search,expression:"search"}],staticClass:"form-control",attrs:{type:"text",placeholder:"Recherche..."},domProps:{value:e.search},on:{input:function(t){t.target.composing||(e.search=t.target.value)}}}),e._m(0)])])]),a("div",{staticClass:"float-md-right"},[a("b-button",{directives:[{name:"b-modal",rawName:"v-b-modal.occupationForm",modifiers:{occupationForm:!0}}],attrs:{variant:"danger"}},[a("i",{staticClass:"fa fa-plus-circle"}),e._v(" Définir une occupation")])],1)])]),a("div",{staticClass:"separator mb-20"}),a("b-overlay",{attrs:{show:e.showOverlay,rounded:"sm"}},[e.occupations.length?a("b-row",[a("div",{staticClass:"card-body"},[a("b-table-simple",{attrs:{hover:"",small:"",responsive:""}},[a("b-thead",{attrs:{"head-variant":"light"}},[a("b-tr",[a("b-th",[e._v("N°")]),a("b-th",[e._v("Logement")]),a("b-th",[e._v("Locataire")]),a("b-th",[e._v("Loyer de base")]),a("b-th",[e._v("Action")])],1)],1),a("b-tbody",e._l(e.occupations,(function(t){return a("b-tr",{key:t.idOccupation},[a("b-td",{staticClass:"p-2"},[e._v(e._s(t.idOccupation))]),a("b-td",{staticClass:"p-2"},[a("span",{staticClass:"d-inline-block w-100 mb-1 font-weight-bold"},[e._v(e._s(t.logement.refLogement))]),a("span",{staticClass:"d-inline-block w-100 mt-1 text-muted"},[e._v(" "+e._s(t.logement.sousTypeLogement.libelleSousType)+" "),t.logement.batiment?a("span",[e._v(" / Batiment : "+e._s(t.logement.batiment.nomBatiment))]):e._e()])]),a("b-td",{staticClass:"p-2"},[a("span",{staticClass:"d-inline-block w-100 mb-1 font-weight-bold"},[e._v(e._s(t.locataire.titre+" "+t.locataire.nomLocataire+" "+t.locataire.prenomLocataire))]),a("span",{staticClass:"d-inline-block w-100 mt-1 text-muted"},[e._v(e._s(t.locataire.tel+" / "+t.locataire.email))])]),a("b-td",{staticClass:"p-2"},[a("span",{staticClass:"d-inline-block w-100 mb-1"},[a("b",[e._v(e._s(t.loyerBase+" F"))]),e._v(" / "),a("small",[e._v(e._s(t.modePaiement))])]),a("span",{staticClass:"d-inline-block w-100 mt-1"},[null==t.dateFin?a("span",{staticClass:"text-success"},[e._v("Bail en cours")]):a("span",{staticClass:"text-danger"},[e._v("Bail terminé")])])]),a("b-td",[a("b-button",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip",value:"Voir les details",expression:"'Voir les details'"}],attrs:{to:{name:"details-occupation",params:{id:t.idOccupation}}}},[a("i",{staticClass:"fa fa-eye"})])],1)],1)})),1)],1)],1)]):a("b-alert",{staticClass:"text-center",attrs:{variant:"info",show:""}},[a("i",{staticClass:"fa fa-exclamation-triangle fa-3x"}),e._v(" "),a("br"),a("span",{staticClass:"h4 d-inline-flex ml-2"},[e._v("Vous n'avez défini aucune occupation pour le moment")])]),a("paginator",{attrs:{hr:"top",offset:e.offset,total:e.occupations.length,limit:e.perPage,page:e.currentPage},on:{pageChanged:function(t){e.currentPage=t},limitChanged:function(t){e.perPage=t}}})],1)],1)]),e.occupation?a("div",{staticClass:"modal fade edit-layout-modal",attrs:{id:"editLayoutItem",tabindex:"-1",role:"dialog","aria-labelledby":"editLayoutItemLabel","aria-hidden":"true"}},[a("div",{staticClass:"modal-dialog",attrs:{role:"document"}},[a("div",{staticClass:"modal-content"},[a("div",{staticClass:"modal-header"},[a("h5",{staticClass:"modal-title",attrs:{id:"editLayoutItemLabel"}},[e._v("Détails de "),a("b",[e._v(e._s(e.habitant.titre))]),e._v(" "),a("b",[e._v(e._s(e.habitant.nomLocataire))])]),e._m(1)]),a("div",{staticClass:"modal-body pt-2"})])])]):e._e(),a("b-modal",{attrs:{id:"occupationForm",size:"lg","hide-footer":"","no-close-on-backdrop":""},scopedSlots:e._u([{key:"modal-title",fn:function(){return[a("span",{staticClass:"ml-4 text-form-occupation"},[e._v(e._s(e.title))])]},proxy:!0}])},[a("div",[a("occupation-form",{attrs:{action:e.action,provenance:e.provenance},on:{occupationAdded:e.addedOccupation}})],1)])],1)},o=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("button",{staticClass:"btn btn-icon",attrs:{type:"submit"}},[a("i",{staticClass:"ik ik-search"})])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal","aria-label":"Close"}},[a("span",{attrs:{"aria-hidden":"true"}},[e._v("×")])])}],s=a("bb61");const n=a("5a6f");var c={name:"list-occupations",components:{OccupationForm:s["a"]},data:()=>({title:"Affecter une occupation",action:"add",search:null,showOverlay:!0,currentPage:1,perPage:4,occupation:null,occupations:[],trueOccupations:[],provenance:1}),computed:{items(){return n.array_slice(this.occupations,this.offset,this.perPage)},offset(){return this.currentPage*this.perPage-this.perPage}},beforeMount(){this.getOccupations()},methods:{sendData(){},addedOccupation(){this.getOccupations(),this.$bvModal.hide("occupationForm")},getOccupations(){axios.get("occupations").then(e=>e.result||[]).then(e=>{this.occupations=this.trueOccupations=e,this.showOverlay=!1})},updateOccupation(e){console.log("occupation",e)},removeOccupation(e){console.log("occupation",e)},showDetails(e){this.occupation=e,setTimeout(()=>{$("#editLayoutItem").modal("show"),$("#editLayoutItem").on("hide.bs.modal",e=>{this.occupation=null}),$("#editLayoutItem").on("hidden.bs.modal",e=>{this.occupation=null})},100)}}},l=c,r=(a("b7aa"),a("2877")),u=Object(r["a"])(l,i,o,!1,null,"044d0f1a",null);t["default"]=u.exports},"66d5":function(e,t,a){},a8d9:function(e,t,a){},b7aa:function(e,t,a){"use strict";a("a8d9")},bb61:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("b-overlay",{attrs:{show:e.showOverlay,rounded:"sm"}},[a("b-row",[a("b-col",[a("b-form-group",{attrs:{label:"Loyer",description:"Combien devra payer le résident"}},[a("b-form-input",{attrs:{placeholder:"Ex: 45000",trim:""},model:{value:e.loyer,callback:function(t){e.loyer=t},expression:"loyer"}})],1)],1),a("b-col",[a("b-form-group",{attrs:{label:"Mode de paiement",description:"Le résident devra t-il payer son loyer courant avant ou après l'avoir consommé"}},[a("b-form-radio-group",{attrs:{name:"radio-options-slots",options:[{text:"Prépayé",value:"prepayer"},{text:"Postpayé",value:"postpayer"}]},model:{value:e.occupation.mode,callback:function(t){e.$set(e.occupation,"mode",t)},expression:"occupation.mode"}})],1)],1)],1),a("b-row",[a("b-col",[a("b-form-group",{attrs:{label:"Facturation d'eau",description:"Comment s'effectuera la facturation en eau de ce résident"}},[a("b-form-select",{staticClass:"mb-1",attrs:{options:[{value:"index",text:"Index"},{value:"forfait",text:"Forfait"}]},model:{value:e.occupation.eau,callback:function(t){e.$set(e.occupation,"eau",t)},expression:"occupation.eau"}})],1)],1),a("b-col",[a("b-form-group",{attrs:{label:"Prix unitaire de l'eau",description:"L'exemple suggéré suppose une facturation par index du compteur"}},[a("b-form-input",{attrs:{min:"0",placeholder:"Ex: 150",trim:"",type:"number"},model:{value:e.occupation.puEau,callback:function(t){e.$set(e.occupation,"puEau",t)},expression:"occupation.puEau"}})],1)],1),a("b-col",[a("b-form-group",{attrs:{label:"Index initial",description:"Index du compteur d'eau à l'entrée du locataire"}},[a("b-form-input",{attrs:{min:"0",placeholder:"Ex: 095",trim:"",type:"number"},model:{value:e.indexEau,callback:function(t){e.indexEau=t},expression:"indexEau"}})],1)],1)],1),a("b-row",[a("b-col",[a("b-form-group",{attrs:{label:"Facturation d'électricité",description:"Comment s'effectuera la facturation en électricité de ce résident"}},[a("b-form-select",{staticClass:"mb-1",attrs:{options:[{value:"index",text:"Index"},{value:"forfait",text:"Forfait"}]},model:{value:e.occupation.energie,callback:function(t){e.$set(e.occupation,"energie",t)},expression:"occupation.energie"}})],1)],1),a("b-col",[a("b-form-group",{attrs:{label:"Prix unitaire de l'energie",description:"L'exemple suggéré suppose une consommation par forfait"}},[a("b-form-input",{attrs:{min:"0",placeholder:"Ex: 2500",trim:"",type:"number"},model:{value:e.occupation.puEnergie,callback:function(t){e.$set(e.occupation,"puEnergie",t)},expression:"occupation.puEnergie"}})],1)],1),a("b-col",[a("b-form-group",{attrs:{label:"Index initial",description:"Index du compteur d'energie à l'entrée du locataire"}},[a("b-form-input",{attrs:{min:"0",placeholder:"Ex: 095",trim:"",type:"number"},model:{value:e.indexEnergie,callback:function(t){e.indexEnergie=t},expression:"indexEnergie"}})],1)],1)],1),a("b-row",{staticClass:"mb-4"},[a("b-col",[a("b-form-group",{attrs:{label:"Quel est le logement concerné par l'occupation"}},[a("div",{staticStyle:{height:"10.5em"}},[a("v-select",{attrs:{options:e.logements,reduce:function(e){return e.idLogement},label:"refLogement"},on:{input:e.setSlide_logement},model:{value:e.occupation.idLogement,callback:function(t){e.$set(e.occupation,"idLogement",t)},expression:"occupation.idLogement"}}),a("b-carousel",{ref:"logementCarousel",attrs:{interval:0,controls:""},model:{value:e.selected_index_logement,callback:function(t){e.selected_index_logement=t},expression:"selected_index_logement"}},e._l(e.logements,(function(t,i){return a("b-carousel-slide",{key:i,staticClass:"fluid w-100 responsive border-0",staticStyle:{height:"10.5em"},attrs:{"img-src":e.empty(t.photos)?"/img/bgHousing.jpg":t.photos[0].image}})})),1)],1)])],1),a("b-col",[a("b-form-group",{attrs:{label:"Qui est le résident pour lequel l'occupation est défini"}},[a("div",{staticStyle:{height:"10.5em"}},[a("v-select",{class:{disabled:1==e.disabled},attrs:{options:e.locataires,label:"nomLocataire"},on:{input:e.setSlide_locataire},model:{value:e.stateLocataire,callback:function(t){e.stateLocataire=t},expression:"stateLocataire"}}),"1"==e.provenance?a("b-carousel",{ref:"locataireCarousel",attrs:{interval:0,controls:""},model:{value:e.selected_index_locataire,callback:function(t){e.selected_index_locataire=t},expression:"selected_index_locataire"}},e._l(e.locataires,(function(e,t){return a("b-carousel-slide",{key:t,staticClass:"fluid w-100 responsive border-0",staticStyle:{height:"10.5em"},attrs:{"img-src":e.avatar}})})),1):e._e(),"2"==e.provenance?a("b-carousel",{ref:"locataireCarousel",attrs:{interval:0,controls:""},model:{value:e.selected_index_locataire,callback:function(t){e.selected_index_locataire=t},expression:"selected_index_locataire"}},[a("b-carousel-slide",{staticClass:"fluid w-100 responsive border-0",staticStyle:{height:"10.5em"},attrs:{"img-src":e.locataire.avatar}})],1):e._e()],1)])],1)],1),a("b-row",{staticClass:"mt-4"},[a("b-col",[a("b-form-group",{attrs:{label:"Date de debut du bail"}},[a("date-picker",{staticClass:"w-100",attrs:{placeholder:"Selectionnez une date",format:"dddd, DD MMMM YYYY",valueType:"YYYY-MM-DD",clearable:!1},model:{value:e.occupation.debut,callback:function(t){e.$set(e.occupation,"debut",t)},expression:"occupation.debut"}})],1)],1),a("b-col",{staticClass:"mt-4"},[a("b-form-checkbox",{attrs:{switch:""},model:{value:e.occupation.endLastBail,callback:function(t){e.$set(e.occupation,"endLastBail",t)},expression:"occupation.endLastBail"}},[a("span",{staticClass:"fa-lg"},[e._v("Mettre fin au bail précédent")])])],1)],1),a("hr"),a("div",{staticClass:"float-right"},[a("b-button",{attrs:{variant:"primary"},on:{click:function(t){return t.preventDefault(),e.submitModal.apply(null,arguments)}}},[e._v("Valider")])],1)],1)},o=[],s=a("ec45"),n=(a("411c"),a("0edd"),a("2c43"));const c=a("5a6f");var l={name:"occupation-form",components:{DatePicker:s["default"]},props:{locataire:{type:Object},provenance:{type:Number,required:!0,default:"1"},action:{type:String,required:!0,default:"add"}},data:()=>({duree:[null,null],selected_index_logement:-1,selected_index_locataire:-1,selected_value:"",occupation:{loyer:"",mode:"",energie:"",eau:"",puEnergie:"",puEau:"",idLogement:"",idLocataire:"",debut:"",indexEnergie:0,indexEau:0,endLastBail:!1},showOverlay:!1,sendForm:!1,logements:[],locataires:[],disabled:!1,stateLocataire:null}),watch:{selected_index_logement(e){const t=this.logements[e];this.occupation.idLogement=t.idLogement,this.indexEnergie=t.lastIndexEnergie?t.lastIndexEnergie.nouveau:0,this.indexEau=t.lastIndexEau?t.lastIndexEau.nouveau:0},selected_index_locataire(e){this.occupation.idLocataire=this.locataires[e].idLocataire}},computed:{logementSelected(){return this.logements.find(e=>e.idLogement==this.occupation.idLogement)},loyer:{get(){const e=this.logementSelected;return e?(e.prixMin+e.prixMax)/2:0},set(e){this.occupation.loyer=e}},indexEnergie:{get(){const e=this.logementSelected;return e&&e.lastIndexEnergie?e.lastIndexEnergie.nouveau:0},set(e){this.occupation.indexEnergie=e}},indexEau:{get(){const e=this.logementSelected;return e&&e.lastIndexEau?e.lastIndexEau.nouveau:0},set(e){this.occupation.indexEau=e}}},methods:{empty(e){return c.empty(e)},setSlide_logement(e){for(let t=0;t<this.logements.length;t++){const a=this.logements[t];if(a.idLogement==e){this.$refs.logementCarousel.setSlide(t),this.indexEnergie=a.lastIndexEnergie?a.lastIndexEnergie.nouveau:0,this.indexEau=a.lastIndexEau?a.lastIndexEau.nouveau:0;break}}},setSlide_locataire(e){for(let t=0;t<this.locataires.length;t++)if(this.locataires[t].idLocataire==e){this.$refs.locataireCarousel.setSlide(t);break}},resetModal(){this.occupation={loyer:"",mode:"",energie:"",eau:"",puEnergie:"",puEau:"",idLogement:"",debut:"",indexEnergie:0,indexEau:0,endLastBail:!1},2!=this.provenance&&(this.occupation.idLocataire="",this.occupation.idLogement="")},submitModal(e){e.preventDefault(),"add"==this.action&&(this.occupation.idLocataire=this.stateLocataire.idLocataire,console.log("occupation",this.occupation),this.showOverlay=!0,axios.post("occupations",this.occupation).then(e=>(this.$emit("occupationAdded"),this.resetModal(),this.showOverlay=!1,App.notifySuccess(e.message))).catch(e=>(this.showOverlay=!1,App.alertError(e.message))))},async getInitialiseData(){try{if(this.logements=await axios.get("logements").then(e=>e.result||[]),this.logements[0]){const e=this.logements[0];this.occupation.idLogement=e.idLogement,e.lastIndexEnergie&&(this.indexEnergie=e.lastIndexEnergie.nouveau),e.lastIndexEau&&(this.indexEau=e.lastIndexEau.nouveau),this.loyer=(e.prixMin+e.prixMax)/2}}catch(e){n["a"].error(e.message)}if(2!=this.provenance)try{this.locataires=await axios.get("locataires").then(e=>e.result||[]),this.locataires[0]&&(this.occupation.idLocataire=this.locataires[0].idLocataire)}catch(e){n["a"].error(e.message)}}},async mounted(){await this.getInitialiseData(),null!=this.locataire&&(this.provenance=2,this.disabled=!0,this.stateLocataire=this.locataire)}},r=l,u=(a("0628"),a("2877")),d=Object(u["a"])(r,i,o,!1,null,"08627a7c",null);t["a"]=d.exports}}]);
//# sourceMappingURL=chunk-c7f2e9aa.751bc0c8.js.map