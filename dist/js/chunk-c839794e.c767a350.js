(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c839794e"],{"1e7f":function(t,e,i){"use strict";i("adc9")},"3c60":function(t,e,i){"use strict";var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("b-overlay",{attrs:{show:t.showOverlay,rounded:"sm"}},[i("div",{staticClass:"d-flex flex-column justify-content-between h-100"},[i("div",{style:null!=t.cite?"height: 73.5vh;":"",attrs:{id:t.repeaterId}},[i("div",{staticClass:"d-flex flex-column justify-content-between",staticStyle:{height:"95%","overflow-y":"auto","overflow-x":"hidden"}},[i("div",{attrs:{"data-repeater-list":"group"}},[i("b-row",{attrs:{"data-repeater-item":""}},[i("b-col",[i("b-form-group",{attrs:{label:"Nom du batiment"}},[i("b-form-input",{attrs:{name:"nom",placeholder:"Ex: Batiment A",trim:""},model:{value:t.nom,callback:function(e){t.nom=e},expression:"nom"}})],1),i("b-form-group",{attrs:{label:"Reference"}},[i("b-form-input",{attrs:{name:"ref",placeholder:"Ex: B1",trim:""},model:{value:t.ref,callback:function(e){t.ref=e},expression:"ref"}})],1),null==t.cite?i("b-form-group",{attrs:{label:"Photo"}},[i("div",{staticClass:"photo-cite d-flex justify-content-center align-items-center border rounded-circle mx-auto",style:"background-image: url("+t.photo.batiment+");"},[i("b-button",{staticClass:"btn-icon",attrs:{variant:"light"},on:{click:function(e){return e.preventDefault(),t.$refs.photoBatiment.click()}}},[i("i",{staticClass:"fa fa-camera-retro fa-lg text-muted"})]),i("input",{ref:"photoBatiment",staticClass:"d-none",attrs:{type:"file",name:"photoBatiment"},on:{change:t.onFileSelected}})],1)]):t._e()],1),i("b-col",[null!=t.cite?i("b-form-group",{attrs:{label:"Photo"}},[i("div",{staticClass:"photo-cite d-flex justify-content-center align-items-center border rounded-circle mx-auto",style:"background-image: url("+t.photo.batiment+");"},[i("b-button",{staticClass:"btn-icon",attrs:{variant:"light"},on:{click:function(e){return e.preventDefault(),t.$refs.photoBatiment.click()}}},[i("i",{staticClass:"fa fa-camera-retro fa-lg text-muted"})]),i("input",{ref:"photoBatiment",staticClass:"d-none",attrs:{type:"file",name:"photoBatiment"},on:{change:t.onFileSelected}})],1)]):i("div",[i("b-form-group",{attrs:{label:"Cité"}},[i("v-select",{staticClass:"py-1",attrs:{options:t.cites,reduce:function(t){return t.idCite},label:"nomCite"},scopedSlots:t._u([{key:"option",fn:function(e){var s=e.nomCite,a=e.refCite,n=e.idCite;return[t._v(" "+t._s(s)+" "),i("br"),i("span",{staticClass:"text-muted"},[t._v(" "+t._s(-1!=n?"Reference: ":"")+t._s(a))]),-1==n?i("hr",{staticClass:"m-0 bg-danger",staticStyle:{"border-width":"1.5px"}}):t._e()]}}]),model:{value:t.idCite,callback:function(e){t.idCite=e},expression:"idCite"}})],1),i("b-carousel",{directives:[{name:"show",rawName:"v-show",value:-1!=t.idCite,expression:"idCite != -1"}],ref:"citeCarousel",attrs:{interval:0,controls:""},model:{value:t.selected_index_cite,callback:function(e){t.selected_index_cite=e},expression:"selected_index_cite"}},t._l(t.slideCites,(function(t,e){return i("b-carousel-slide",{key:e,staticClass:"fluid w-100 responsive border",staticStyle:{height:"20em"},attrs:{"img-src":t.image||"/img/bgCity.jpg"}})})),1),-1==t.idCite?i("div",[i("b-row",[i("b-col",[i("b-form-group",{attrs:{label:"Nom de la cité"}},[i("b-form-input",{attrs:{placeholder:"Ex: Cité de la joie",trim:""},model:{value:t.nomCite,callback:function(e){t.nomCite=e},expression:"nomCite"}})],1)],1),i("b-col",[i("b-form-group",{attrs:{label:"Reférence de la cité"}},[i("b-form-input",{attrs:{placeholder:"Ex: CDJ",trim:""},model:{value:t.refCite,callback:function(e){t.refCite=e},expression:"refCite"}})],1)],1)],1),i("b-form-group",{attrs:{label:"Photo"}},[i("div",{staticClass:"photo-cite d-flex justify-content-center align-items-center border rounded-circle mx-auto",style:"background-image: url("+t.photo.cite+");"},[i("b-button",{staticClass:"btn-icon",attrs:{variant:"light"},on:{click:function(e){return e.preventDefault(),t.$refs.photoCite.click()}}},[i("i",{staticClass:"fa fa-camera-retro fa-lg text-muted"})]),i("input",{ref:"photoCite",staticClass:"d-none",attrs:{type:"file",name:"photoCite"},on:{change:t.onFileSelected}})],1)])],1):t._e()],1)],1),null!=t.cite?i("b-col",{staticClass:"m-0 p-0 mr-2",attrs:{cols:"1"}},[i("b-form-group",{attrs:{label:"Action"}},[i("b-button",{attrs:{"data-repeater-delete":"",variant:"outline-danger"}},[i("i",{staticClass:"fa fa-times"})])],1)],1):t._e()],1)],1)]),i("div",{staticClass:"w-100 d-flex justify-content-end align-items-center mt-4"},[null!=t.cite?i("b-button",{attrs:{variant:"outline-primary","data-repeater-create":""}},[t._v("Ajouter un élément")]):t._e(),i("b-button",{staticClass:"ml-2",attrs:{variant:"danger",disabled:t.submitted},on:{click:t.submitForm}},[t._v("Valider "),t.submitted?i("b-spinner",{attrs:{small:""}}):t._e()],1)],1)])])])},a=[];const n=i("5a6f");var r={data:()=>({submitted:!1,showOverlay:!0,cites:[],idCite:-1,nom:null,ref:null,nomCite:null,refCite:null,photo:{batiment:null,cite:null},selected_index_cite:null}),watch:{selected_index_cite(t){this.idCite=this.slideCites[t].idCite},idCite(t){this.setSlide_cite(t)}},props:{action:{type:String,default:"add"},batiment:{type:Object,default:null},cite:{type:Object,default:null}},computed:{repeaterId(){return"repeat-added-batiment-form-"+(n.empty(this.cite)?n.uniqid():this.cite.idCite)},slideCites(){return this.cites.filter(t=>-1!=t.idCite)}},created(){this.getCites()},mounted(){n.empty(this.cite)||(this.makeRepeater(),this.idCite=this.cite.idCite)},methods:{async getCites(){let t=storage.get("cites");n.empty(t)&&(t=await axios.get("cites").then(t=>t.result||[]),storage.set("cites",t,10)),this.cites=t||[],n.empty(this.batiment)?this.cites.unshift({nomCite:"Créer une nouvelle cité",refCite:"Ajout d'une cité inexistante",idCite:-1}):(this.nom=this.batiment.nomBatiment,this.ref=this.batiment.refBatiment,this.photo.batiment=this.batiment.image,this.idCite=this.batiment.idCite),this.showOverlay=!1},makeRepeater(){setTimeout(()=>{$("#"+this.repeaterId).repeater({isFirstItemUndeletable:!0})},500)},setSlide_cite(t){for(let e=0;e<this.slideCites.length;e++)if(this.slideCites[e].idCite==t&&!n.empty(this.$refs.citeCarousel)){this.$refs.citeCarousel.setSlide(e);break}},onFileSelected({target:t}){let e=t.files[0],i=new FileReader,s=t.name,a=this.photo;i.onload=function(){"photoCite"==s?a.cite=this.result:a.batiment=this.result},i.readAsDataURL(e)},async submitForm(){if(n.empty(this.nom)||n.empty(this.ref)||n.empty(this.idCite))return App.error("Veuillez remplir le nom et la reference du batiment");if(-1==this.idCite&&(n.empty(this.nomCite)||n.empty(this.refCite)))return App.error("Veuillez entrer le nom et la reference de la cité");this.submitted=!0;let t={nom:this.nom,idCite:this.idCite,ref:this.ref,photo:this.photo.batiment,batiments:[]};if("add"==this.action){if(-1==t.idCite)try{let e=await axios.post("cites",{nom:this.nomCite,ref:this.refCite,photo:this.photo.cite});t.idCite=e.result.idCite}catch(e){return App.alertError(e.message)}if(!n.empty(this.cite)){let e=$("#"+this.repeaterId).repeaterVal().group;if(n.empty(e[0].nom)||n.empty(e[0].ref))return App.error("Vous devez remplir au moins les informations du premier batiment");t.batiments=e}axios.post("batiments",t).then(t=>(this.$emit("batimentAdded",t.result),this.submitted=!1,App.notifySuccess(t.message))).catch(t=>(this.submitted=!1,App.notifyError(t.message)))}"edit"!=this.action||n.empty(this.batiment)||axios.put("batiments/"+this.batiment.idBatiment,t).then(e=>(this.$emit("batimentUpdated",{...t,idBatiment:this.batiment.idBatiment}),this.submitted=!1,App.notifySuccess(e.message))).catch(t=>(this.submitted=!1,App.notifyError(t.message)))}}},o=r,l=(i("72f8"),i("2877")),c=Object(l["a"])(o,s,a,!1,null,"abf9e20e",null);e["a"]=c.exports},"5c21":function(t,e,i){"use strict";var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"shadow list-item list-item-grid"},[i("div",{staticClass:"card d-flex flex-row mb-3"},[i("a",{staticClass:"d-flex card-img",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.showDetails.apply(null,arguments)}}},[i("img",{staticClass:"list-thumbnail responsive border-0",staticStyle:{height:"10em"},attrs:{src:t.batiment.image||"/img/batiment.jpg",alt:""}}),t.isNew?i("span",{staticClass:"badge badge-pill badge-primary position-absolute badge-top-left"},[t._v("New")]):t._e()]),i("div",{staticClass:"d-flex flex-grow-1 min-width-zero card-content"},[i("div",{staticClass:"card-body align-self-center d-flex flex-column flex-md-row justify-content-between min-width-zero align-items-md-center"},[i("div",{staticClass:"text-center"},[i("h4",{staticClass:"text-red mt-0 truncate"},[t._v(t._s(t.batiment.nomBatiment))]),i("span",{staticClass:"d-inline-block text-muted"},[t._v("Reference: "),i("b",[t._v(t._s(t.batiment.refBatiment))])])]),t.isSub?i("p",{staticClass:"text-muted mt-3 mb-1 date w-15 w-xs-100 text-small"},[t._v(t._s(t.$date(t.batiment.createdAt).format("DD.MM.YYYY")))]):i("p",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.bottom",value:t.dateCreation,expression:"dateCreation",modifiers:{bottom:!0}}],staticClass:"mt-3 mb-1 text-muted text-small date w-15 w-xs-100"},[t._v(t._s(t.$date(t.batiment.createdAt).format("DD.MM.YYYY")))])]),i("div",{staticClass:"list-actions"},[t.isSub?t._e():i("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.showDetails.apply(null,arguments)}}},[i("i",{staticClass:"ik ik-eye"})]),t.isSub?i("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.accessTo.apply(null,arguments)}}},[i("i",{staticClass:"ik ik-link"})]):t._e(),t.isSub?t._e():i("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.$emit("makeUpdate",t.batiment)}}},[i("i",{staticClass:"ik ik-edit-2"})]),i("a",{staticClass:"list-delete",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.remove.apply(null,arguments)}}},[i("i",{staticClass:"ik ik-trash-2"})])])])])])},a=[],n={props:{batiment:{type:Object,required:!0},isSub:{type:Boolean,default:!1}},computed:{dateCreation(){const t=this.$date(this.batiment.createdAt);return`Créée le ${t.format("dddd, DD MMMM YYYY")} à ${t.format("HH:mm")}`},isNew(){return dayjs().diff(this.batiment.createdAt,"week")<=1}},methods:{showDetails(){if(this.isSub)return!1;this.$emit("showDetails",this.batiment)},accessTo(){$("#editLayoutItem").modal("hide"),this.$router.push({name:"batiments",query:{target:this.batiment.idBatiment}})},remove(){App.confirm(`Voullez vous vraiment supprimer le batiment " <b>${this.batiment.nomBatiment}</b> " ?`,{confirm:()=>{axios.delete("batiments/"+this.batiment.idBatiment).then(t=>t.success?(this.$emit("deleted",this.batiment.idBatiment),App.notifySuccess(t.message)):App.notifyError(t.message)).catch(t=>{App.notifyError(t.message)})}})}}},r=n,o=i("2877"),l=Object(o["a"])(r,s,a,!1,null,null,null);e["a"]=l.exports},"72f8":function(t,e,i){"use strict";i("f2dd")},adc9:function(t,e,i){},bc60:function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("page-description",{attrs:{title:"Cités",description:"Gestion de vos cités",icon:"city",path:["Patrimoine immobilier","Mes cités"]}}),i("div",{staticClass:"row"},[i("div",{staticClass:"col-md-12"},[i("div",{staticClass:"mb-2 clearfix"},[i("div",{staticClass:"collapse d-md-block display-options",attrs:{id:"displayOptions"}},[i("div",{staticClass:"d-block d-md-inline-block"},[i("div",{staticClass:"search-sm d-inline-block float-md-left mr-1 mb-1 align-top"},[i("form",{attrs:{action:"",onSubmit:"return false"}},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.search,expression:"search"}],staticClass:"form-control",attrs:{type:"text",placeholder:"Recherche..."},domProps:{value:t.search},on:{input:function(e){e.target.composing||(t.search=e.target.value)}}}),t._m(0)])])]),i("div",{staticClass:"float-md-right"},[i("b-button",{attrs:{variant:"danger"},on:{click:function(e){return e.preventDefault(),function(){t.modal.action="add",t.$bvModal.show("modal-cite")}.apply(null,arguments)}}},[i("i",{staticClass:"fa fa-plus-circle"}),t._v(" Nouvelle cité")])],1)])]),i("div",{staticClass:"separator mb-20"}),i("b-overlay",{attrs:{show:t.showOverlay,rounded:"sm"}},[t.cites.length?i("b-row",{staticClass:"layout-wrap"},t._l(t.items,(function(e,s){return i("b-col",{key:e.idCite||s,staticClass:"animated flipInX mb-4",attrs:{xl:"3",lg:"4",cols:"12",sm:"6"}},[i("app-cite",{attrs:{cite:e},on:{makeUpdate:t.updateCite,deleted:t.removeCite,showDetails:t.showDetails}})],1)})),1):i("b-alert",{staticClass:"text-center",attrs:{variant:"info",show:""}},[i("i",{staticClass:"fa fa-exclamation-triangle fa-3x"}),t._v(" "),i("br"),i("span",{staticClass:"h4 d-inline-flex ml-2"},[t._v("Aucune cité trouvée")])]),i("paginator",{attrs:{hr:"top",offset:t.offset,total:t.cites.length,limit:t.perPage,page:t.currentPage},on:{pageChanged:function(e){t.currentPage=e},limitChanged:function(e){t.perPage=e}}})],1)],1)]),t.cite?i("div",{staticClass:"modal fade edit-layout-modal",attrs:{id:"editLayoutItem",tabindex:"-1",role:"dialog","aria-labelledby":"editLayoutItemLabel","aria-hidden":"true"}},[i("div",{staticClass:"modal-dialog",attrs:{role:"document"}},[i("div",{staticClass:"modal-content"},[i("div",{staticClass:"modal-header"},[i("h5",{staticClass:"modal-title",attrs:{id:"editLayoutItemLabel"}},[t._v("Détails de la cité : "),i("b",[t._v(t._s(t.cite.nomCite))]),t._v(".")]),t._m(1)]),i("div",{staticClass:"modal-body pt-2"},[i("details-cite",{attrs:{cite:t.cite},on:{batimentsChanged:t.changeBatiments}})],1)])])]):t._e(),i("b-modal",{ref:"modalCite",attrs:{id:"modal-cite",size:"sm"},on:{hidden:t.resetModal,ok:t.submitModal},scopedSlots:t._u([{key:"modal-title",fn:function(){return["add"==t.modal.action?i("span",[t._v("Ajouter une cité")]):t._e(),"edit"==t.modal.action?i("span",[t._v("Edition de la cité")]):t._e()]},proxy:!0},{key:"modal-footer",fn:function(e){var s=e.ok;return[i("b-button",{attrs:{size:"sm",variant:"danger",disabled:t.modal.submitted},on:{click:function(t){return s()}}},[t._v("Valider "),t.modal.submitted?i("b-spinner",{attrs:{small:""}}):t._e()],1)]}}])},[i("b-form-group",{attrs:{label:"Nom de la cité"}},[i("b-form-input",{attrs:{placeholder:"Ex: Cité de la paix",trim:""},model:{value:t.modal.nom,callback:function(e){t.$set(t.modal,"nom",e)},expression:"modal.nom"}})],1),i("b-form-group",{attrs:{label:"Reference"}},[i("b-form-input",{attrs:{placeholder:"Ex: CP3",trim:""},model:{value:t.modal.ref,callback:function(e){t.$set(t.modal,"ref",e)},expression:"modal.ref"}})],1),i("b-form-group",{attrs:{label:"Photo"}},[i("div",{staticClass:"photo-cite d-flex justify-content-center align-items-center border rounded-circle mx-auto",style:"background-image: url("+t.modal.photo+");"},[i("b-button",{staticClass:"btn-icon",attrs:{variant:"light"},on:{click:function(e){return e.preventDefault(),t.$refs.photoCite.click()}}},[i("i",{staticClass:"fa fa-camera-retro fa-lg text-muted"})]),i("input",{ref:"photoCite",staticClass:"d-none",attrs:{type:"file"},on:{change:t.onFileSelected}})],1)])],1)],1)},a=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("button",{staticClass:"btn btn-icon",attrs:{type:"submit"}},[i("i",{staticClass:"ik ik-search"})])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal","aria-label":"Close"}},[i("span",{attrs:{"aria-hidden":"true"}},[t._v("×")])])}],n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:" list-item list-item-grid"},[i("div",{staticClass:"card d-flex flex-row mb-3"},[i("a",{staticClass:"d-flex card-img",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.showDetails.apply(null,arguments)}}},[i("img",{staticClass:"list-thumbnail responsive border-0",staticStyle:{height:"10em"},attrs:{src:t.cite.image||"/img/bgCity.jpg",alt:""}}),t.isNew?i("span",{staticClass:"badge badge-pill badge-primary position-absolute badge-top-left"},[t._v("New")]):t._e()]),i("div",{staticClass:"d-flex flex-grow-1 min-width-zero card-content"},[i("div",{staticClass:"card-body align-self-center d-flex flex-column flex-md-row justify-content-between min-width-zero align-items-md-center"},[i("div",{staticClass:"text-center"},[i("h4",{staticClass:"text-red mt-0 truncate"},[t._v(t._s(t.cite.nomCite))]),i("span",{staticClass:"d-inline-block text-muted"},[t._v("Reference: "),i("b",[t._v(t._s(t.cite.refCite))])])]),i("p",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.bottom",value:t.dateCreation,expression:"dateCreation",modifiers:{bottom:!0}}],staticClass:"mt-3 mb-1 text-muted text-small date w-15 w-xs-100"},[t._v(t._s(t.$date(t.cite.createdAt).format("DD.MM.YYYY")))])]),i("div",{staticClass:"list-actions"},[i("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.showDetails.apply(null,arguments)}}},[i("i",{staticClass:"ik ik-eye"})]),i("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.$emit("makeUpdate",t.cite)}}},[i("i",{staticClass:"ik ik-edit-2"})]),i("a",{staticClass:"list-delete",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.remove.apply(null,arguments)}}},[i("i",{staticClass:"ik ik-trash-2"})])])])])])},r=[],o={props:{cite:{type:Object,required:!0},isSub:{type:Boolean,default:!1}},computed:{dateCreation(){const t=this.$date(this.cite.createdAt);return`Créée le ${t.format("dddd, DD MMMM YYYY")} à ${t.format("HH:mm")}`},isNew(){return dayjs().diff(this.cite.createdAt,"hour")<=1}},methods:{showDetails(){if(this.isSub)return!1;this.$emit("showDetails",this.cite)},remove(){App.confirm(`Voullez vous vraiment supprimer la cité " <b>${this.cite.nomCite}</b> " ?`,{confirm:()=>{axios.delete("cites/"+this.cite.idCite).then(t=>t.success?(this.$emit("deleted",this.cite.idCite),App.notifySuccess(t.message)):App.notifyError(t.message))}})}}},l=o,c=i("2877"),d=Object(c["a"])(l,n,r,!1,null,null,null),m=d.exports,u=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("ul",{staticClass:"nav nav-tabs"},[i("li",{staticClass:"nav-item"},[i("a",{staticClass:"nav-link",class:{active:"batiments"==t.section},attrs:{"data-toggle":"tab",href:"#"},on:{click:function(e){e.preventDefault(),t.section="batiments"}}},[t._v("Batiments")])]),i("li",{staticClass:"nav-item"},[i("a",{staticClass:"nav-link",class:{active:"stats"==t.section},attrs:{"data-toggle":"tab",href:"#"},on:{click:function(e){e.preventDefault(),t.section="stats"}}},[t._v("Statistiques générales")])]),i("li",{staticClass:"nav-item"},[i("a",{staticClass:"nav-link",class:{active:"add-batiments"==t.section},attrs:{"data-toggle":"tab",href:"#"},on:{click:function(e){e.preventDefault(),t.section="add-batiments"}}},[t._v("Ajouter des bâtiments")])]),i("li",{staticClass:"nav-item"},[i("a",{staticClass:"nav-link",class:{active:"depenses"==t.section},attrs:{"data-toggle":"tab",href:"#"},on:{click:function(e){e.preventDefault(),t.section="depenses"}}},[t._v("Dépenses liées à la cité")])]),i("li",{staticClass:"nav-item"},[i("a",{staticClass:"nav-link",class:{active:"add-depense"==t.section},attrs:{"data-toggle":"tab",href:"#"},on:{click:function(e){e.preventDefault(),t.section="add-depense"}}},[t._v("Ajouter une dépense")])])]),i("div",{staticClass:"tab-content mt-3"},[i("div",{staticClass:"tab-pane fade show active"},["stats"==t.section?i("div",{staticClass:"jumbotron pt-10 pb-10"},[i("h3",{staticClass:"m-0"},[t._v("Statistiques générales")]),i("p",[t._v("This is a simple hero unit, a simple jumbotron-style component for calling extra attention to featured content or information.")])]):t._e(),"batiments"==t.section?i("div",[t.cite.batiments.length?i("div",{staticStyle:{height:"75vh"}},[i("paginator",{attrs:{"no-control":"",hr:"bottom",total:t.cite.batiments.length,limit:t.perPage,page:t.currentPage},on:{pageChanged:function(e){t.currentPage=e},limitChanged:function(e){t.perPage=e}}}),i("div",{staticStyle:{height:"90%","overflow-y":"auto","overflow-x":"hidden"}},[i("b-row",{staticClass:"layout-wrap"},t._l(t.items,(function(e,s){return i("b-col",{key:e.idBatiment||s,attrs:{cols:"6"}},[i("batiment",{attrs:{batiment:e,"is-sub":""},on:{deleted:t.removeBatiment}})],1)})),1)],1)],1):i("b-alert",{attrs:{variant:"info",show:""}},[i("i",{staticClass:"fa fa-exclamation-triangle fa-3x float-left"}),i("span",{staticClass:"h4 d-inline-flex ml-2"},[t._v("Aucun bâtiment enregistré pour le moment")])])],1):t._e(),i("div",{directives:[{name:"show",rawName:"v-show",value:"add-batiments"==t.section,expression:"section == 'add-batiments'"}]},[i("form-batiment",{attrs:{cite:t.cite},on:{batimentAdded:t.pushBatiment}})],1),"depenses"==t.section?i("div",[t.cite.depenses.length?t._e():i("b-alert",{attrs:{variant:"info",show:""}},[i("i",{staticClass:"fa fa-exclamation-triangle fa-3x float-left"}),i("span",{staticClass:"h4 d-inline-flex ml-2"},[t._v("Aucune dépense enregistrée pour le moment")])]),t.cite.depenses.length>0?i("div",{staticStyle:{height:"75vh"}},[i("b-row",[i("paginator",{attrs:{"no-control":"",hr:"bottom",total:t.cite.depenses.length,limit:t.perPage,page:t.currentPage},on:{pageChanged:function(e){t.currentPage=e},limitChanged:function(e){t.perPage=e}}})],1),i("div",{staticStyle:{height:"90%","overflow-y":"auto","overflow-x":"hidden"}},[i("b-row",{staticClass:"layout-wrap"},t._l(t.itemsDepenses,(function(e,s){return i("b-col",{key:e.idDepense||s,attrs:{cols:"6"}},[i("depense",{attrs:{depense:e,source:t.source,"is-sub":""},on:{deleted:t.removeDepense}})],1)})),1)],1)],1):t._e()],1):t._e(),i("div",{directives:[{name:"show",rawName:"v-show",value:"add-depense"==t.section,expression:"section == 'add-depense'"}]},[i("depense-form",{attrs:{cite:t.cite,provenance:t.provenance},on:{depenseAdded:t.addedDepense}})],1)])])])},h=[],p=i("5c21"),f=i("5ad6"),b=i("a474"),C=i("3c60");const v=i("5a6f");var g={props:{cite:{type:Object,required:!0}},components:{Batiment:p["a"],Depense:f["a"],DepenseForm:b["a"],FormBatiment:C["a"]},computed:{items(){return v.array_slice(this.cite.batiments||[],this.offset,this.perPage)},itemsDepenses(){return v.array_slice(this.cite.depenses||[],this.offset,this.perPage)},offset(){return this.currentPage*this.perPage-this.perPage}},data:()=>({section:"add-batiments",submitted:!1,currentPage:1,perPage:10,source:1,provenance:"2",action:""}),mounted(){this.section="batiments",this.makeRepeater()},methods:{addedDepense(){axios.get(`cites/${this.cite.idCite}/depenses`).then(t=>t.result||[]).then(t=>{this.cite.depenses=t,this.section="depenses"})},pushBatiment(t){if(this.cite.batiments.push(...t),this.$emit("batimentsChanged",this.cite.batiments),this.section="batiments",!t.length)return App.notif("Aucun batiment rajouté",{})},removeBatiment(t){this.cite.batiments=this.cite.batiments.filter(e=>e.idBatiment!=t),this.$emit("batimentsChanged",this.cite.batiments)},removeDepense(t){this.cite.depenses=this.cite.depenses.filter(e=>e.idDepense!=t),this.$emit("depensesChanged",this.cite.depenses)},defineDepense(){this.action="add",this.commandeDepense=!0},onCloseSet(){this.commandeDepense=!1}}},y=g,x=Object(c["a"])(y,u,h,!1,null,null,null),w=x.exports;const _=i("5a6f");var k={name:"Cites",components:{AppCite:m,DetailsCite:w},computed:{items(){return _.array_slice(this.cites,this.offset,this.perPage)},offset(){return this.currentPage*this.perPage-this.perPage}},data:()=>({cites:[],trueCites:[],showOverlay:!0,cite:null,currentPage:1,perPage:10,search:null,modal:{action:"",submitted:!1,nom:"",ref:"",idCite:"",photo:""}}),watch:{search(t){_.empty(t)?this.cites=this.trueCites:this.cites=this.trueCites.filter(e=>e.nomCite.toLowerCase().includes(t.toLowerCase()))}},beforeMount(){this.getCities()},mounted(){this.autoAddTarget()},methods:{showModal(){this.modal.action="add",this.$refs.modalCite.show("modal-cite")},onFileSelected(t){let e=t.target.files[0],i=new FileReader,s=this.modal;i.onload=function(){s.photo=this.result},i.readAsDataURL(e)},getCities(){axios.get("cites").then(t=>t.result||[]).then(t=>{this.cites=this.trueCites=t,this.showOverlay=!1})},autoAddTarget(){const t=this.$route.query.target||null;t&&(this.showModal(),window.history.replaceState({},"",window.location.href.split("?")[0]))},showDetails(t){this.cite=t,setTimeout(()=>{$("#editLayoutItem").modal("show"),$("#editLayoutItem").on("hide.bs.modal",t=>{this.cite=null}),$("#editLayoutItem").on("hidden.bs.modal",t=>{this.cite=null})},100)},changeBatiments(t){this.cites=this.cites.map(e=>e.idCite!=this.cite.idCite?e:{...e,batiments:t}),this.cite.batiments=t},removeCite(t){this.cites=this.cites.filter(e=>e.idCite!=t),this.trueCites=this.trueCites.filter(e=>e.idCite!=t)},resetModal(){this.modal={action:"",submitted:!1,nom:"",ref:"",idCite:"",photo:""}},submitModal(t){if(t.preventDefault(),_.empty(this.modal.nom)||_.empty(this.modal.ref))return App.error("Veuillez remplir tous les champs du formulaire");this.modal.submitted=!0,"add"==this.modal.action&&axios.post("cites",this.modal).then(t=>(this.modal.submitted=!1,t.success?(this.cites=this.addNewCite(this.cites,t.result),this.trueCites=this.addNewCite(this.trueCites,t.result),this.$bvModal.hide("modal-cite"),App.notifySuccess(t.message)):App.alertError(t.message))).catch(t=>(this.modal.submitted=!1,App.alertError(t.message))),"edit"==this.modal.action&&axios.put("cites/"+this.modal.idCite,this.modal).then(t=>(this.modal.submitted=!1,t.success?(this.cites=this.renameCite(this.cites,this.modal),this.trueCites=this.renameCite(this.trueCites,this.modal),this.$bvModal.hide("modal-cite"),App.notifySuccess(t.message)):App.alertError(t.message))).catch(t=>(this.modal.submitted=!1,App.alertError(t.message)))},updateCite(t){this.modal={action:"edit",nom:t.nomCite,ref:t.refCite,idCite:t.idCite,photo:t.image},this.$bvModal.show("modal-cite")},addNewCite(t,e){let i=!1;for(let s=0;s<t.length;s++)if(t[s].idCite==e.idCite){i=!0;break}return i||t.push(e),t},renameCite(t,e){return t.map(t=>(t.idCite==e.idCite&&(t.nomCite=e.nom,t.refCite=e.ref,t.image=e.photo),t))}}},D=k,A=(i("1e7f"),Object(c["a"])(D,s,a,!1,null,"f2c782c4",null));e["default"]=A.exports},f2dd:function(t,e,i){}}]);
//# sourceMappingURL=chunk-c839794e.c767a350.js.map